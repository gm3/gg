(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const m of n.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function i(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(t){if(t.ep)return;t.ep=!0;const n=i(t);fetch(t.href,n)}})();const Z={LOCAL:"local",REMOTE:"remote"};let re=Z.LOCAL;function ke(e={}){e.persistence?.mode===Z.REMOTE?re=Z.REMOTE:re=Z.LOCAL}async function Te(e,o){re===Z.REMOTE&&console.warn("[persistence] REMOTE mode selected but no remote saver implemented; saving to localStorage instead.");try{window.localStorage.setItem(e,JSON.stringify(o))}catch{}}let ue="skill_tree_progress",Ee={},W={},Ne={};function Ae(e){ue=e.storageKey||"skill_tree_progress",ke(e),Ee={},Object.keys(e.statTypes||{}).forEach(o=>{Ee[o.toUpperCase()]=o}),Ne=e.statTypes||{},W=e.defaultStats||{},b={completedQuests:[],lastUpdated:null,reflections:{},evidence:{},stats:{...W}}}function he(){return{...Ne}}let b={completedQuests:[],lastUpdated:null,reflections:{},evidence:{},stats:{}};const pe=new Set;function V(){for(const e of pe)e(b)}function Me(){try{const e=window.__skillTreeInitialSnapshot||null;if(!e){const o=window.localStorage.getItem(ue);if(!o)return b.stats={...W},b;const i=JSON.parse(o);return Array.isArray(i.completedQuests)?(b={completedQuests:i.completedQuests,lastUpdated:i.lastUpdated||null,reflections:i.reflections||{},evidence:i.evidence||{},stats:i.stats||{...W}},V(),b):(b.stats={...W},b)}if(!Array.isArray(e.completedQuests))return b.stats={...W},b;b={completedQuests:e.completedQuests,lastUpdated:e.lastUpdated||null,reflections:e.reflections||{},evidence:e.evidence||{},stats:e.stats||{...W}},V()}catch{b.stats={...W}}return b}function ee(){try{Te(ue,b)}catch{}}function H(e){return b.completedQuests.includes(e)}function Se(e,o,i={}){const a=b.completedQuests.includes(e),t=new Set(b.completedQuests);if(o&&!a){t.add(e);const n={...b.stats};Object.keys(i).forEach(m=>{n[m]=(n[m]||0)+(i[m]||0)}),b={...b,completedQuests:Array.from(t),stats:n,lastUpdated:new Date().toISOString().slice(0,10)}}else if(!o&&a){t.delete(e);const n={...b.stats};Object.keys(i).forEach(m=>{n[m]=Math.max(0,(n[m]||0)-(i[m]||0))}),b={...b,completedQuests:Array.from(t),stats:n,lastUpdated:new Date().toISOString().slice(0,10)}}ee(),V()}function me(){return b}function Oe(e,o){b={...b,reflections:{...b.reflections,[e]:o},lastUpdated:new Date().toISOString().slice(0,10)},ee(),V()}function ae(){b={completedQuests:[],lastUpdated:new Date().toISOString().slice(0,10),reflections:{},evidence:{},stats:{...W}},ee(),V()}function q(e){return b.evidence?.[e]||{note:"",status:"unsubmitted"}}function Ce(e,o){const i=b.evidence?.[e]||{note:"",status:"unsubmitted"};b={...b,evidence:{...b.evidence,[e]:{...i,...o}},lastUpdated:new Date().toISOString().slice(0,10)},ee(),V()}function xe(e){return pe.add(e),()=>pe.delete(e)}function $e(){return{...b.stats}}function je(){return Object.values(b.stats).reduce((e,o)=>e+o,0)}function ie(e,o,i=null,a=""){const t=$e(),n=je(),m=document.createElement("div");if(m.className="character-stats",i){const r=document.createElement("div");r.className="character-stats__toggle",r.appendChild(i),m.appendChild(r)}if(a){const r=document.createElement("div");r.className="character-stats__tree-name",r.textContent=a,m.appendChild(r)}const u=document.createElement("div");u.className="character-stats__bar";const f=document.createElement("div");f.className="character-stats__stat";const l=document.createElement("span");l.className="character-stats__value",l.textContent=`${e}/${o}`;const c=document.createElement("span");c.className="character-stats__label",c.textContent="Nodes",f.appendChild(l),f.appendChild(c),u.appendChild(f);const h=he();Object.entries(t).forEach(([r,E])=>{const x=document.createElement("div");x.className="character-stats__stat";const T=document.createElement("span");T.className="character-stats__value",T.textContent=`+${E}`;const M=document.createElement("span");M.className="character-stats__label",M.textContent=h[r]||r,x.appendChild(T),x.appendChild(M),u.appendChild(x)});const p=document.createElement("div");p.className="character-stats__stat character-stats__stat--total";const d=document.createElement("span");d.className="character-stats__value",d.textContent=n;const s=document.createElement("span");return s.className="character-stats__label",s.textContent="Total",p.appendChild(d),p.appendChild(s),u.appendChild(p),m.appendChild(u),m}function Re(e,o,i){const a=H(e.id),t=document.createElement("div");t.className="node-modal",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true");const n=document.createElement("div");n.className="node-modal__backdrop",n.addEventListener("click",o),t.appendChild(n);const m=document.createElement("div");m.className="node-modal__content";const u=document.createElement("div");u.className="node-modal__header";const f=document.createElement("div");f.className="node-modal__title-row";const l=document.createElement("span");l.className="node-modal__emoji",l.textContent=e.emoji||"üçÉ";const c=document.createElement("h2");c.className="node-modal__title",c.textContent=e.title,f.appendChild(l),f.appendChild(c),u.appendChild(f);const h=document.createElement("button");h.className="node-modal__close",h.textContent="√ó",h.setAttribute("aria-label","Close modal"),h.addEventListener("click",o),u.appendChild(h),m.appendChild(u);const p=document.createElement("div");p.className="node-modal__body";const d=document.createElement("p");d.className="node-modal__description",d.textContent=e.description,p.appendChild(d);const s=document.createElement("div");s.className="node-modal__meta";const r=document.createElement("span");if(r.className="node-modal__category",r.textContent=`${e.category} ‚Ä¢ Tier ${e.tier}`,s.appendChild(r),p.appendChild(s),e.points){const C=document.createElement("div");C.className="node-modal__points";const w=document.createElement("h3");w.className="node-modal__points-title",w.textContent="Points Awarded:",C.appendChild(w);const N=document.createElement("div");N.className="node-modal__points-list";const L=he();Object.entries(e.points).forEach(([X,Y])=>{if(Y>0){const F=document.createElement("div");F.className="node-modal__point-item";const J=document.createElement("span");J.className="node-modal__point-label",J.textContent=L[X]||X;const Q=document.createElement("span");Q.className="node-modal__point-value",Q.textContent=`+${Y}`,F.appendChild(J),F.appendChild(Q),N.appendChild(F)}}),C.appendChild(N),p.appendChild(C)}const E=document.createElement("div");E.className="node-modal__toggle";const x=document.createElement("input");x.type="checkbox",x.id=`quest-${e.id}`,x.className="node-modal__checkbox",x.checked=a,x.addEventListener("change",C=>{const w=C.target.checked;Se(e.id,w,e.points||{}),i&&i(),w?m.classList.add("node-modal__content--completed"):m.classList.remove("node-modal__content--completed")});const T=document.createElement("label");if(T.htmlFor=`quest-${e.id}`,T.className="node-modal__checkbox-label",T.textContent=a?"Completed":"Mark as completed",E.appendChild(x),E.appendChild(T),p.appendChild(E),a){const C=document.createElement("div");C.className="node-modal__reflection";const w=document.createElement("label");w.className="node-modal__reflection-label",w.textContent="Reflection (optional):";const N=document.createElement("textarea");N.className="node-modal__reflection-input",N.placeholder="How did this feel? What did you learn?",N.rows=4;const L=me();L.reflections&&L.reflections[e.id]&&(N.value=L.reflections[e.id]),N.addEventListener("blur",()=>{Oe(e.id,N.value)}),C.appendChild(w),C.appendChild(N),p.appendChild(C)}const M=q(e.id),k=document.createElement("div");k.className="node-modal__evidence";const A=document.createElement("label");A.className="node-modal__evidence-label",A.textContent="Evidence / Attachments (optional):";const O=document.createElement("textarea");O.className="node-modal__evidence-input",O.placeholder="Links to videos, images, files, or notes for a future reviewer.",O.rows=3,O.value=M.note||"",O.addEventListener("blur",()=>{Ce(e.id,{note:O.value})});const R=document.createElement("div");R.className="node-modal__evidence-meta";const g=document.createElement("span");g.className="node-modal__evidence-status";const y=M.status||"unsubmitted";g.textContent=y.toUpperCase(),g.dataset.status=y;const _=document.createElement("button");_.className="node-modal__evidence-submit",_.textContent=M.status==="submitted"?"Resubmit evidence":"Submit for review",_.addEventListener("click",()=>{Ce(e.id,{note:O.value,status:"submitted"}),g.textContent="SUBMITTED",g.dataset.status="submitted",_.textContent="Resubmit evidence"}),R.appendChild(g),R.appendChild(_),k.appendChild(A),k.appendChild(O),k.appendChild(R),p.appendChild(k),m.appendChild(p),t.appendChild(m),a&&m.classList.add("node-modal__content--completed");const S=C=>{C.key==="Escape"&&o()};return document.addEventListener("keydown",S),t.addEventListener("remove",()=>{document.removeEventListener("keydown",S)}),t}function ye(e,o,i,a,t,n=[]){const m=new Set(o);e.innerHTML="";let u=e.clientWidth||window.innerWidth||1e3,f=e.clientHeight||window.innerHeight||800;const l="http://www.w3.org/2000/svg",c=document.createElementNS(l,"svg");c.setAttribute("viewBox",`0 0 ${u} ${f}`),c.setAttribute("class","skill-map");let h=100;const p=50,d=300,s=5,r=Array.from(new Set(n.map(v=>v.tier))).sort((v,B)=>v-B),E=u/2,x=f/2,T=Math.min(u,f),M=T*.18,k=T*.16,A=T*.045,O=6;let R=A;const g=[];r.forEach((v,B)=>{const U=M+B*k,$=n.filter(j=>j.tier===v),z=$.length||1,I=Math.PI*2/z,P=-Math.PI/2;if(z>1){const j=Math.PI*2/z,D=2*U*Math.sin(j/2),K=Math.max(O,Math.min(A,D*.6/2));R=Math.min(R,K)}$.forEach((j,D)=>{const K=P+I*D,te=E+U*Math.cos(K),ne=x+U*Math.sin(K);g.push({quest:j,x:te,y:ne,tier:v})})}),g.forEach(({quest:v,x:B,y:U})=>{const $=document.createElementNS(l,"circle");$.setAttribute("cx",String(B)),$.setAttribute("cy",String(U)),$.setAttribute("r",String(R)),$.setAttribute("data-id",v.id),$.setAttribute("data-title",v.title),$.setAttribute("data-description",v.description);const z=m.has(v.id);$.setAttribute("class",z?"skill-map__node skill-map__node--completed":"skill-map__node"),$.addEventListener("click",P=>{P.stopPropagation(),i&&i(v)}),$.addEventListener("mouseenter",P=>{if(a){const j=e.getBoundingClientRect(),D={x:P.clientX-j.left,y:P.clientY-j.top};a(v,D)}}),$.addEventListener("mouseleave",()=>{t&&t()}),$.addEventListener("mousemove",P=>{if(a){const j=e.getBoundingClientRect(),D={x:P.clientX-j.left,y:P.clientY-j.top};a(v,D)}});const I=document.createElementNS(l,"text");I.setAttribute("x",String(B)),I.setAttribute("y",String(U+R*.15)),I.setAttribute("class","skill-map__emoji"),I.setAttribute("font-size",String(R*1.2)),I.setAttribute("data-id",v.id),I.textContent=v.emoji||"üçÉ",c.appendChild($),c.appendChild(I)}),e.appendChild(c);let y=!1,_={x:0,y:0},S={x:0,y:0};const C=v=>{v.preventDefault();const B=v.deltaY>0?-s:s;h=Math.max(p,Math.min(d,h+B)),X()},w=v=>{(v.button===1||v.button===2||v.button===0&&Y)&&(v.preventDefault(),y=!0,_={x:v.clientX-S.x,y:v.clientY-S.y},e.style.cursor="grabbing")},N=v=>{y&&(S={x:v.clientX-_.x,y:v.clientY-_.y},X())},L=()=>{y=!1,e.style.cursor="grab"},X=()=>{const v=h/100;c.style.transform=`translate(${S.x}px, ${S.y}px) scale(${v})`,c.style.transformOrigin="center center"};let Y=!1;const F=v=>{(v.key===" "||v.key==="Space")&&(Y=!0,e.style.cursor="grab")},J=v=>{(v.key===" "||v.key==="Space")&&(Y=!1,e.style.cursor="")};e.addEventListener("wheel",C,{passive:!1}),e.addEventListener("mousedown",w),window.addEventListener("mousemove",N),window.addEventListener("mouseup",L),window.addEventListener("keydown",F),window.addEventListener("keyup",J),e.addEventListener("contextmenu",v=>{y&&v.preventDefault()}),e.style.cursor="grab";const Q=()=>{u=e.clientWidth||window.innerWidth||1e3,f=e.clientHeight||window.innerHeight||800,c.setAttribute("viewBox",`0 0 ${u} ${f}`),c.setAttribute("width",String(u)),c.setAttribute("height",String(f));const v=u/2,B=f/2,U=Math.min(u,f),$=U*.18,z=U*.16;r.forEach((I,P)=>{const j=$+P*z,D=n.filter(G=>G.tier===I),K=D.length||1,te=Math.PI*2/K,ne=-Math.PI/2;D.forEach((G,Le)=>{const ge=ne+te*Le,ve=v+j*Math.cos(ge),_e=B+j*Math.sin(ge),se=c.querySelector(`circle[data-id="${G.id}"]`);se&&(se.setAttribute("cx",String(ve)),se.setAttribute("cy",String(_e)));const oe=c.querySelector(`text[data-id="${G.id}"]`);oe&&(oe.setAttribute("x",String(ve)),oe.setAttribute("y",String(_e+3)))})})},fe=new ResizeObserver(Q);return fe.observe(e),window.addEventListener("resize",Q),{svg:c,setZoom:v=>{h=Math.max(p,Math.min(d,v)),c.style.transform=`scale(${h/100})`,c.style.transformOrigin="center center"},getZoom:()=>h,destroy:()=>{e.removeEventListener("wheel",C),e.removeEventListener("mousedown",w),window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",L),window.removeEventListener("keydown",F),window.removeEventListener("keyup",J),window.removeEventListener("resize",Q),fe.disconnect()}}}function Ie(e,o,i){const a=document.createElement("div");a.className="list-tier";const t=document.createElement("button");t.className="list-tier__header",t.setAttribute("aria-expanded","true");const n=document.createElement("span");n.className="list-tier__title";const m={1:"üå±",2:"üåø",3:"üå≥"};n.textContent=`${m[e]||"üìã"} Tier ${e}`;const u=document.createElement("span");u.className="list-tier__count";const f=o.filter(s=>H(s.id)).length;u.textContent=`${f}/${o.length}`;const l=document.createElement("span");l.className="list-tier__icon",l.textContent="‚ñº",t.appendChild(n),t.appendChild(u),t.appendChild(l);const c=document.createElement("div");c.className="list-tier__content",c.style.display="block";const h=[...o].sort((s,r)=>{const E=H(s.id),x=H(r.id);return E===x?0:E?1:-1}),p=h.filter(s=>!H(s.id)),d=h.filter(s=>H(s.id));if(p.forEach(s=>{const r=be(s,i);c.appendChild(r)}),p.length>0&&d.length>0){const s=document.createElement("div");s.className="list-tier__separator",s.textContent="Completed",c.appendChild(s)}return d.forEach(s=>{const r=be(s,i);c.appendChild(r)}),t.addEventListener("click",()=>{const s=c.style.display!=="none";c.style.display=s?"none":"block",t.setAttribute("aria-expanded",!s),l.textContent=s?"‚ñ∂":"‚ñº",a.classList.toggle("list-tier--collapsed",s)}),a.appendChild(t),a.appendChild(c),a}function be(e,o){const i=H(e.id),t=q(e.id).status||"unsubmitted",n=document.createElement("div"),m=t==="submitted"?" list-node--pending-evidence":t==="approved"?" list-node--approved-evidence":"";n.className=`list-node ${i?"list-node--completed":""}${m}`,n.setAttribute("data-quest-id",e.id);const u=document.createElement("button");u.className="list-node__main";const f=document.createElement("div");f.className="list-node__left";const l=document.createElement("span");l.className="list-node__emoji",l.textContent=e.emoji||"üçÉ";const c=document.createElement("div");c.className="list-node__info";const h=document.createElement("span");h.className="list-node__title",h.textContent=e.title;const p=document.createElement("span");p.className="list-node__category",p.textContent=e.category,c.appendChild(h),c.appendChild(p),f.appendChild(l),f.appendChild(c);const d=document.createElement("div");if(d.className="list-node__right",e.points){const k=document.createElement("div");k.className="list-node__points",Object.entries(e.points).forEach(([A,O])=>{if(O>0){const g=he()[A]||A,y=document.createElement("span");y.className="list-node__point",y.textContent=`+${O} ${g.substring(0,3)}`,k.appendChild(y)}}),d.appendChild(k)}const s=document.createElement("input");s.type="checkbox",s.className="list-node__checkbox",s.checked=i,s.addEventListener("change",k=>{k.stopPropagation();const A=n.closest(".list-view-container"),O=A?A.scrollTop:0;Se(e.id,k.target.checked,e.points||{}),n.classList.toggle("list-node--completed",k.target.checked),A&&O>0&&requestAnimationFrame(()=>{A.scrollTop=O})});const r=document.createElement("span");r.className="list-node__expand",r.textContent="‚ñ∂",d.appendChild(s),d.appendChild(r),u.appendChild(f),u.appendChild(d);const E=document.createElement("div");E.className="list-node__details",E.style.display="none";const x=document.createElement("p");x.className="list-node__description",x.textContent=e.description;const T=document.createElement("div");T.className="list-node__actions";const M=document.createElement("button");return M.className="list-node__action-btn",M.textContent="View Details",M.addEventListener("click",k=>{k.stopPropagation(),o&&o(e)}),T.appendChild(M),E.appendChild(x),E.appendChild(T),u.addEventListener("click",()=>{const k=E.style.display!=="none";E.style.display=k?"none":"block",r.textContent=k?"‚ñ∂":"‚ñº",n.classList.toggle("list-node--expanded",!k)}),n.appendChild(u),n.appendChild(E),n}function Pe(e,o=[]){const i=document.createElement("div");i.className="list-view";let a="all",t=0;const n=i.closest(".list-view-container")||i.parentElement;function m(){n&&(t=n.scrollTop)}function u(){n&&t>0&&requestAnimationFrame(()=>{n.scrollTop=t})}function f(){m(),i.innerHTML="";const l=document.createElement("div");l.className="list-view__filters",[{id:"all",label:"All"},{id:"active",label:"Active"},{id:"completed",label:"Completed"},{id:"in_review",label:"In Review"},{id:"accepted",label:"Accepted"}].forEach(d=>{const s=document.createElement("button");s.className=`list-view__filter ${a===d.id?"list-view__filter--active":""}`,s.textContent=d.label,s.addEventListener("click",()=>{a=d.id,f()}),l.appendChild(s)}),i.appendChild(l);const h=new Map;o.forEach(d=>{h.has(d.tier)||h.set(d.tier,[]),h.get(d.tier).push(d)}),Array.from(h.keys()).sort((d,s)=>d-s).forEach(d=>{const s=h.get(d);let r=s;if(a==="active"?r=s.filter(E=>!H(E.id)):a==="completed"?r=s.filter(E=>H(E.id)):a==="in_review"?r=s.filter(E=>q(E.id).status==="submitted"):a==="accepted"&&(r=s.filter(E=>q(E.id).status==="approved")),r.length>0||a==="all"){const x=Ie(d,a==="all"?s:r,e);i.appendChild(x)}}),u()}return f(),xe(()=>{f()}),i}function le(e,o){const i=document.createElement("div");i.className="progress-stepper";const a=o?Math.round(e/o*100):0,t=[0,25,50,75,100],n=document.createElement("div");n.className="progress-stepper__bar",t.forEach((u,f)=>{const l=document.createElement("div");l.className="progress-stepper__step";const c=a>=u,h=a>=u&&(f===t.length-1||a<t[f+1]);c&&l.classList.add("progress-stepper__step--reached"),h&&l.classList.add("progress-stepper__step--current");const p=document.createElement("div");p.className="progress-stepper__circle",c?p.textContent="‚úì":p.textContent=u;const d=document.createElement("div");if(d.className="progress-stepper__label",d.textContent=`${u}%`,l.appendChild(p),l.appendChild(d),f<t.length-1){const s=document.createElement("div");s.className="progress-stepper__connector",c&&a>=t[f+1]&&s.classList.add("progress-stepper__connector--filled"),l.appendChild(s)}n.appendChild(l)});const m=document.createElement("div");return m.className="progress-stepper__info",m.textContent=`${e} of ${o} nodes completed`,i.appendChild(n),i.appendChild(m),i}function ce(e,o){const i=document.createElement("div");i.className="settings-menu";const a=document.createElement("button");a.className="settings-menu__button",a.setAttribute("aria-label","Settings menu"),a.setAttribute("aria-expanded","false"),a.textContent="‚ò∞";const t=document.createElement("div");t.className="settings-menu__dropdown",t.style.display="none";const n=document.createElement("button");n.className="settings-menu__item",n.textContent="Export JSON",n.addEventListener("click",()=>{e&&e(),h()});const m=document.createElement("button");m.className="settings-menu__item",m.textContent="Load config JSON",m.addEventListener("click",()=>{const p=document.createElement("input");p.type="file",p.accept="application/json",p.style.display="none",p.addEventListener("change",async()=>{const d=p.files&&p.files[0];if(d)try{const s=await d.text(),r=JSON.parse(s);if(!r.quests||!Array.isArray(r.quests)){window.alert('Invalid config: missing "quests" array.');return}window.localStorage.setItem("skill_tree_custom_config",s),window.location.reload()}catch(s){console.error("Failed to load config JSON",s),window.alert("Failed to load config JSON. Please check the file format.")}}),document.body.appendChild(p),p.click(),p.addEventListener("blur",()=>{p.remove()}),h()});const u=document.createElement("button");u.className="settings-menu__item",u.textContent="Open demo site",u.addEventListener("click",()=>{window.open("https://gm3.github.io/gg/","_blank"),h()});const f=document.createElement("button");f.className="settings-menu__item",f.textContent="Open GitHub repo",f.addEventListener("click",()=>{window.open("https://github.com/gm3/gg","_blank"),h()});const l=document.createElement("button");l.className="settings-menu__item settings-menu__item--danger",l.textContent="Clear All",l.addEventListener("click",()=>{window.confirm("Reset all completed quests and reflections?")&&o&&o(),h()}),t.appendChild(n),t.appendChild(m),t.appendChild(u),t.appendChild(f),t.appendChild(l);function c(){t.style.display="block",a.setAttribute("aria-expanded","true"),a.classList.add("settings-menu__button--active")}function h(){t.style.display="none",a.setAttribute("aria-expanded","false"),a.classList.remove("settings-menu__button--active")}return a.addEventListener("click",p=>{p.stopPropagation(),t.style.display==="block"?h():c()}),document.addEventListener("click",p=>{i.contains(p.target)||h()}),i.appendChild(a),i.appendChild(t),i}function we(){return window.innerWidth<768||window.innerHeight>window.innerWidth}function Be(e,{quests:o,config:i}){Me();let a=null,t=null,n=we()?"list":"tree";function m(){const d={progress:me(),quests:o,config:i,exportedAt:new Date().toISOString()},s=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),r=URL.createObjectURL(s),E=document.createElement("a");E.href=r,E.download=`${i?.appName?.toLowerCase().replace(/\s+/g,"-")||"skill-tree"}-progress.json`,E.click(),URL.revokeObjectURL(r)}function u(d){a&&f(),a=Re(d,f,()=>{h()}),e.appendChild(a)}function f(){a&&(a.dispatchEvent(new Event("remove")),a.remove(),a=null)}let l=e.querySelector(".fullscreen-container"),c=!0;function h(){const{completedQuests:d}=me(),s=d.length,r=o.length;if(c||!l)e.innerHTML="",l=document.createElement("div"),l.className="fullscreen-container",e.appendChild(l),c=!1;else if(n==="list"){const g=l.querySelector(".overlay-stats");if(g){g.innerHTML="";const _=document.createElement("button");_.className="view-toggle",_.setAttribute("aria-label","Toggle view");const S=document.createElement("span");S.className="view-toggle__icon",S.textContent=n==="tree"?"‚ò∞":"üå≥";const C=document.createElement("span");C.className="view-toggle__label",C.textContent=n==="tree"?"List":"Tree",_.appendChild(S),_.appendChild(C),_.addEventListener("click",()=>{n=n==="tree"?"list":"tree",c=!0,h()});const w=ce(m,()=>{ae()}),N=document.createElement("div");N.className="character-stats__toggle",N.appendChild(_),N.appendChild(w);const L=ie(s,r,N,i?.appName||"Skill Tree");g.appendChild(L)}const y=l.querySelector(".list-view-container");if(y){const _=y.querySelector(".progress-stepper");if(_){const S=le(s,r);_.replaceWith(S)}}return}else if(n==="tree"){const g=l.querySelector(".overlay-stats");if(g){g.innerHTML="";const _=document.createElement("button");_.className="view-toggle",_.setAttribute("aria-label","Toggle view");const S=document.createElement("span");S.className="view-toggle__icon",S.textContent=n==="tree"?"‚ò∞":"üå≥";const C=document.createElement("span");C.className="view-toggle__label",C.textContent=n==="tree"?"List":"Tree",_.appendChild(S),_.appendChild(C),_.addEventListener("click",()=>{n=n==="tree"?"list":"tree",c=!0,h()});const w=ce(m,()=>{ae()}),N=document.createElement("div");N.className="character-stats__toggle",N.appendChild(_),N.appendChild(w);const L=ie(s,r,N,i?.appName||"Skill Tree");g.appendChild(L)}const y=l.querySelector(".tree-visual-fullscreen");if(y){const _=y.querySelector(".tree-visual__canvas-fullscreen");_&&t&&(t.destroy&&t.destroy(),t=ye(_,d,S=>u(S),(S,C)=>{const w=y.querySelector(".tree-tooltip");if(w&&S&&C){w.style.display="block",w.textContent=`${S.emoji||"üçÉ"} ${S.title}`;const N=w.offsetWidth||150;let L=C.x;L<N/2?L=N/2:L>y.clientWidth-N/2&&(L=y.clientWidth-N/2),w.style.left=`${L}px`,w.style.top=`${Math.max(C.y-8,8)}px`}},()=>{const S=y.querySelector(".tree-tooltip");S&&(S.style.display="none")},o))}return}let E=l.querySelector(".overlay-stats");E?E.innerHTML="":(E=document.createElement("div"),E.className="overlay-stats",l.appendChild(E));const x=document.createElement("button");x.className="view-toggle",x.setAttribute("aria-label","Toggle view");const T=document.createElement("span");T.className="view-toggle__icon",T.textContent=n==="tree"?"‚ò∞":"üå≥";const M=document.createElement("span");M.className="view-toggle__label",M.textContent=n==="tree"?"List":"Tree",x.appendChild(T),x.appendChild(M),x.addEventListener("click",()=>{n=n==="tree"?"list":"tree",c=!0,h()});const k=ce(m,()=>{ae()}),A=document.createElement("div");A.className="character-stats__toggle",A.appendChild(x),A.appendChild(k);const O=ie(s,r,A,i?.appName||"Skill Tree");if(E.appendChild(O),n==="tree"){let S=function(C,w){if(_)if(C&&w){_.style.display="block",_.textContent=`${C.emoji||"üçÉ"} ${C.title}`;const N=_.offsetWidth||150;let L=w.x;L<N/2?L=N/2:L>g.clientWidth-N/2&&(L=g.clientWidth-N/2),_.style.left=`${L}px`,_.style.top=`${Math.max(w.y-8,8)}px`}else _.style.display="none"};var R=S;let g=l.querySelector(".tree-visual-fullscreen");if(!g){g=document.createElement("section"),g.className="tree-visual-fullscreen";const C=document.createElement("div");C.className="tree-visual__canvas-fullscreen",g.appendChild(C),l.appendChild(g);const w=document.createElement("div");w.className="tree-tooltip",w.style.display="none",g.appendChild(w)}let y=g.querySelector(".tree-visual__canvas-fullscreen");y||(y=document.createElement("div"),y.className="tree-visual__canvas-fullscreen",g.appendChild(y));const _=g.querySelector(".tree-tooltip");t&&t.destroy&&(t.destroy(),t=null),y.innerHTML="",t=ye(y,d,C=>u(C),(C,w)=>S(C,w),()=>S(null),o)}else{let g=l.querySelector(".list-view-container");if(g){const y=g.querySelector(".progress-stepper");if(y){const _=le(s,r);y.replaceWith(_)}}else{g=document.createElement("section"),g.className="list-view-container",l.appendChild(g);const y=le(s,r);g.appendChild(y);const _=Pe(S=>u(S),o);g.appendChild(_)}}if(n==="tree"){const g=document.createElement("div");g.className="overlay-bottom";const y=document.createElement("div");y.className="overlay-instructions",y.textContent="Scroll to zoom ‚Ä¢ Drag to pan ‚Ä¢ Click nodes for details",g.appendChild(y),l.appendChild(g)}}const p=()=>{we()&&n==="tree"&&(n="list",h())};return window.addEventListener("resize",p),h(),xe(h),()=>{window.removeEventListener("resize",p),t&&t.destroy&&t.destroy(),a&&f()}}let de=null;async function De(){if(de)return de;try{let e=null;try{const o=window.localStorage.getItem("skill_tree_custom_config");o&&(e=JSON.parse(o))}catch(o){console.warn("Failed to parse custom config from localStorage, ignoring override",o),e=null}if(!e){const o=await fetch("config.json");if(!o.ok)throw new Error("Failed to load config.json");e=await o.json()}return(!e.quests||!Array.isArray(e.quests))&&(console.warn("config.json missing quests array, using empty array"),e.quests=[]),(!e.statTypes||typeof e.statTypes!="object")&&(console.warn("config.json missing statTypes, using defaults"),e.statTypes={goodness:"Goodness",thoughtfulness:"Thoughtfulness",kindness:"Kindness",empathy:"Empathy"}),(!e.defaultStats||typeof e.defaultStats!="object")&&(console.warn("config.json missing defaultStats, initializing from statTypes"),e.defaultStats={},Object.keys(e.statTypes).forEach(o=>{e.defaultStats[o]=0})),de=e,e}catch(e){return console.error("Failed to load config.json:",e),{appName:"Skill Tree",statTypes:{goodness:"Goodness",thoughtfulness:"Thoughtfulness",kindness:"Kindness",empathy:"Empathy"},defaultStats:{goodness:0,thoughtfulness:0,kindness:0,empathy:0},storageKey:"skill_tree_progress",quests:[]}}}async function Ue(){const e=document.querySelector("#app");if(!e){console.error("App root element not found");return}try{const o=await De();Ae(o);const i=o.quests||[];if(i.length===0){console.warn("No quests found in config.json"),e.innerHTML='<div style="padding: 2rem; text-align: center; color: #e5e7eb;"><h2>No quests found</h2><p>Please ensure config.json contains a "quests" array with at least one quest.</p></div>';return}Be(e,{config:o,quests:i})}catch(o){console.error("Failed to initialize app:",o),e.innerHTML='<div style="padding: 2rem; text-align: center; color: #e5e7eb;"><h2>Error loading app</h2><p>Please check the console for details.</p></div>'}}Ue();
