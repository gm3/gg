(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const p of n.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function l(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(t){if(t.ep)return;t.ep=!0;const n=l(t);fetch(t.href,n)}})();const K={LOCAL:"local",REMOTE:"remote"};let ce=K.LOCAL;function Se(e={}){e.persistence?.mode===K.REMOTE?ce=K.REMOTE:ce=K.LOCAL}async function xe(e,s){ce===K.REMOTE&&console.warn("[persistence] REMOTE mode selected but no remote saver implemented; saving to localStorage instead.");try{window.localStorage.setItem(e,JSON.stringify(s))}catch{}}let pe="skill_tree_progress",ge={},B={},ye={};function Le(e){pe=e.storageKey||"skill_tree_progress",Se(e),ge={},Object.keys(e.statTypes||{}).forEach(s=>{ge[s.toUpperCase()]=s}),ye=e.statTypes||{},B=e.defaultStats||{},w={completedQuests:[],lastUpdated:null,reflections:{},evidence:{},stats:{...B}}}function me(){return{...ye}}let w={completedQuests:[],lastUpdated:null,reflections:{},evidence:{},stats:{}};const re=new Set;function z(){for(const e of re)e(w)}function ke(){try{const e=window.__skillTreeInitialSnapshot||null;if(!e){const s=window.localStorage.getItem(pe);if(!s)return w.stats={...B},w;const l=JSON.parse(s);return Array.isArray(l.completedQuests)?(w={completedQuests:l.completedQuests,lastUpdated:l.lastUpdated||null,reflections:l.reflections||{},evidence:l.evidence||{},stats:l.stats||{...B}},z(),w):(w.stats={...B},w)}if(!Array.isArray(e.completedQuests))return w.stats={...B},w;w={completedQuests:e.completedQuests,lastUpdated:e.lastUpdated||null,reflections:e.reflections||{},evidence:e.evidence||{},stats:e.stats||{...B}},z()}catch{w.stats={...B}}return w}function G(){try{xe(pe,w)}catch{}}function U(e){return w.completedQuests.includes(e)}function be(e,s,l={}){const i=w.completedQuests.includes(e),t=new Set(w.completedQuests);if(s&&!i){t.add(e);const n={...w.stats};Object.keys(l).forEach(p=>{n[p]=(n[p]||0)+(l[p]||0)}),w={...w,completedQuests:Array.from(t),stats:n,lastUpdated:new Date().toISOString().slice(0,10)}}else if(!s&&i){t.delete(e);const n={...w.stats};Object.keys(l).forEach(p=>{n[p]=Math.max(0,(n[p]||0)-(l[p]||0))}),w={...w,completedQuests:Array.from(t),stats:n,lastUpdated:new Date().toISOString().slice(0,10)}}G(),z()}function de(){return w}function Te(e,s){w={...w,reflections:{...w.reflections,[e]:s},lastUpdated:new Date().toISOString().slice(0,10)},G(),z()}function se(){w={completedQuests:[],lastUpdated:new Date().toISOString().slice(0,10),reflections:{},evidence:{},stats:{...B}},G(),z()}function Z(e){return w.evidence?.[e]||{note:"",status:"unsubmitted"}}function ve(e,s){const l=w.evidence?.[e]||{note:"",status:"unsubmitted"};w={...w,evidence:{...w.evidence,[e]:{...l,...s}},lastUpdated:new Date().toISOString().slice(0,10)},G(),z()}function we(e){return re.add(e),()=>re.delete(e)}function Ae(){return{...w.stats}}function Me(){return Object.values(w.stats).reduce((e,s)=>e+s,0)}function oe(e,s,l=null){const i=Ae(),t=Me(),n=document.createElement("div");if(n.className="character-stats",l){const o=document.createElement("div");o.className="character-stats__toggle",o.appendChild(l),n.appendChild(o)}const p=document.createElement("div");p.className="character-stats__bar";const u=document.createElement("div");u.className="character-stats__stat";const v=document.createElement("span");v.className="character-stats__value",v.textContent=`${e}/${s}`;const c=document.createElement("span");c.className="character-stats__label",c.textContent="Nodes",u.appendChild(v),u.appendChild(c),p.appendChild(u);const a=me();Object.entries(i).forEach(([o,C])=>{const h=document.createElement("div");h.className="character-stats__stat";const x=document.createElement("span");x.className="character-stats__value",x.textContent=`+${C}`;const A=document.createElement("span");A.className="character-stats__label",A.textContent=a[o]||o,h.appendChild(x),h.appendChild(A),p.appendChild(h)});const f=document.createElement("div");f.className="character-stats__stat character-stats__stat--total";const E=document.createElement("span");E.className="character-stats__value",E.textContent=t;const r=document.createElement("span");return r.className="character-stats__label",r.textContent="Total",f.appendChild(E),f.appendChild(r),p.appendChild(f),n.appendChild(p),n}function Oe(e,s,l){const i=U(e.id),t=document.createElement("div");t.className="node-modal",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true");const n=document.createElement("div");n.className="node-modal__backdrop",n.addEventListener("click",s),t.appendChild(n);const p=document.createElement("div");p.className="node-modal__content";const u=document.createElement("div");u.className="node-modal__header";const v=document.createElement("div");v.className="node-modal__title-row";const c=document.createElement("span");c.className="node-modal__emoji",c.textContent=e.emoji||"üçÉ";const a=document.createElement("h2");a.className="node-modal__title",a.textContent=e.title,v.appendChild(c),v.appendChild(a),u.appendChild(v);const f=document.createElement("button");f.className="node-modal__close",f.textContent="√ó",f.setAttribute("aria-label","Close modal"),f.addEventListener("click",s),u.appendChild(f),p.appendChild(u);const E=document.createElement("div");E.className="node-modal__body";const r=document.createElement("p");r.className="node-modal__description",r.textContent=e.description,E.appendChild(r);const o=document.createElement("div");o.className="node-modal__meta";const C=document.createElement("span");if(C.className="node-modal__category",C.textContent=`${e.category} ‚Ä¢ Tier ${e.tier}`,o.appendChild(C),E.appendChild(o),e.points){const _=document.createElement("div");_.className="node-modal__points";const N=document.createElement("h3");N.className="node-modal__points-title",N.textContent="Points Awarded:",_.appendChild(N);const b=document.createElement("div");b.className="node-modal__points-list";const L=me();Object.entries(e.points).forEach(([Y,Q])=>{if(Q>0){const H=document.createElement("div");H.className="node-modal__point-item";const d=document.createElement("span");d.className="node-modal__point-label",d.textContent=L[Y]||Y;const j=document.createElement("span");j.className="node-modal__point-value",j.textContent=`+${Q}`,H.appendChild(d),H.appendChild(j),b.appendChild(H)}}),_.appendChild(b),E.appendChild(_)}const h=document.createElement("div");h.className="node-modal__toggle";const x=document.createElement("input");x.type="checkbox",x.id=`quest-${e.id}`,x.className="node-modal__checkbox",x.checked=i,x.addEventListener("change",_=>{const N=_.target.checked;be(e.id,N,e.points||{}),l&&l(),N?p.classList.add("node-modal__content--completed"):p.classList.remove("node-modal__content--completed")});const A=document.createElement("label");if(A.htmlFor=`quest-${e.id}`,A.className="node-modal__checkbox-label",A.textContent=i?"Completed":"Mark as completed",h.appendChild(x),h.appendChild(A),E.appendChild(h),i){const _=document.createElement("div");_.className="node-modal__reflection";const N=document.createElement("label");N.className="node-modal__reflection-label",N.textContent="Reflection (optional):";const b=document.createElement("textarea");b.className="node-modal__reflection-input",b.placeholder="How did this feel? What did you learn?",b.rows=4;const L=de();L.reflections&&L.reflections[e.id]&&(b.value=L.reflections[e.id]),b.addEventListener("blur",()=>{Te(e.id,b.value)}),_.appendChild(N),_.appendChild(b),E.appendChild(_)}const $=Z(e.id),k=document.createElement("div");k.className="node-modal__evidence";const M=document.createElement("label");M.className="node-modal__evidence-label",M.textContent="Evidence / Attachments (optional):";const T=document.createElement("textarea");T.className="node-modal__evidence-input",T.placeholder="Links to videos, images, files, or notes for a future reviewer.",T.rows=3,T.value=$.note||"",T.addEventListener("blur",()=>{ve(e.id,{note:T.value})});const P=document.createElement("div");P.className="node-modal__evidence-meta";const m=document.createElement("span");m.className="node-modal__evidence-status";const y=$.status||"unsubmitted";m.textContent=y.toUpperCase(),m.dataset.status=y;const g=document.createElement("button");g.className="node-modal__evidence-submit",g.textContent=$.status==="submitted"?"Resubmit evidence":"Submit for review",g.addEventListener("click",()=>{ve(e.id,{note:T.value,status:"submitted"}),m.textContent="SUBMITTED",m.dataset.status="submitted",g.textContent="Resubmit evidence"}),P.appendChild(m),P.appendChild(g),k.appendChild(M),k.appendChild(T),k.appendChild(P),E.appendChild(k),p.appendChild(E),t.appendChild(p),i&&p.classList.add("node-modal__content--completed");const S=_=>{_.key==="Escape"&&s()};return document.addEventListener("keydown",S),t.addEventListener("remove",()=>{document.removeEventListener("keydown",S)}),t}function _e(e,s,l,i,t,n=[]){const p=new Set(s);e.innerHTML="";let u=e.clientWidth||window.innerWidth||1e3,v=e.clientHeight||window.innerHeight||800;const c="http://www.w3.org/2000/svg",a=document.createElementNS(c,"svg");a.setAttribute("viewBox",`0 0 ${u} ${v}`),a.setAttribute("class","skill-map");let f=100;const E=50,r=300,o=5,C=Array.from(new Set(n.map(d=>d.tier))).sort((d,j)=>d-j),h=u/2,x=v/2,A=Math.min(u,v),$=A*.18,k=A*.16,M=[];C.forEach((d,j)=>{const W=$+j*k,O=n.filter(I=>I.tier===d),J=O.length||1,D=Math.PI*2/J,R=-Math.PI/2;O.forEach((I,F)=>{const V=R+D*F,q=h+W*Math.cos(V),ee=x+W*Math.sin(V);M.push({quest:I,x:q,y:ee,tier:d})})}),M.forEach(({quest:d,x:j,y:W})=>{const O=document.createElementNS(c,"circle");O.setAttribute("cx",String(j)),O.setAttribute("cy",String(W)),O.setAttribute("r","10"),O.setAttribute("data-id",d.id),O.setAttribute("data-title",d.title),O.setAttribute("data-description",d.description);const J=p.has(d.id);O.setAttribute("class",J?"skill-map__node skill-map__node--completed":"skill-map__node"),O.addEventListener("click",R=>{R.stopPropagation(),l&&l(d)}),O.addEventListener("mouseenter",R=>{if(i){const I=e.getBoundingClientRect(),F={x:R.clientX-I.left,y:R.clientY-I.top};i(d,F)}}),O.addEventListener("mouseleave",()=>{t&&t()}),O.addEventListener("mousemove",R=>{if(i){const I=e.getBoundingClientRect(),F={x:R.clientX-I.left,y:R.clientY-I.top};i(d,F)}});const D=document.createElementNS(c,"text");D.setAttribute("x",String(j)),D.setAttribute("y",String(W+3)),D.setAttribute("class","skill-map__emoji"),D.setAttribute("data-id",d.id),D.textContent=d.emoji||"üçÉ",a.appendChild(O),a.appendChild(D)}),e.appendChild(a);let T=!1,P={x:0,y:0},m={x:0,y:0};const y=d=>{d.preventDefault();const j=d.deltaY>0?-o:o;f=Math.max(E,Math.min(r,f+j)),N()},g=d=>{(d.button===1||d.button===2||d.button===0&&b)&&(d.preventDefault(),T=!0,P={x:d.clientX-m.x,y:d.clientY-m.y},e.style.cursor="grabbing")},S=d=>{T&&(m={x:d.clientX-P.x,y:d.clientY-P.y},N())},_=()=>{T=!1,e.style.cursor="grab"},N=()=>{const d=f/100;a.style.transform=`translate(${m.x}px, ${m.y}px) scale(${d})`,a.style.transformOrigin="center center"};let b=!1;const L=d=>{(d.key===" "||d.key==="Space")&&(b=!0,e.style.cursor="grab")},Y=d=>{(d.key===" "||d.key==="Space")&&(b=!1,e.style.cursor="")};e.addEventListener("wheel",y,{passive:!1}),e.addEventListener("mousedown",g),window.addEventListener("mousemove",S),window.addEventListener("mouseup",_),window.addEventListener("keydown",L),window.addEventListener("keyup",Y),e.addEventListener("contextmenu",d=>{T&&d.preventDefault()}),e.style.cursor="grab";const Q=()=>{u=e.clientWidth||window.innerWidth||1e3,v=e.clientHeight||window.innerHeight||800,a.setAttribute("viewBox",`0 0 ${u} ${v}`),a.setAttribute("width",String(u)),a.setAttribute("height",String(v));const d=u/2,j=v/2,W=Math.min(u,v),O=W*.18,J=W*.16;C.forEach((D,R)=>{const I=O+R*J,F=n.filter(X=>X.tier===D),V=F.length||1,q=Math.PI*2/V,ee=-Math.PI/2;F.forEach((X,Ne)=>{const ue=ee+q*Ne,fe=d+I*Math.cos(ue),he=j+I*Math.sin(ue),te=a.querySelector(`circle[data-id="${X.id}"]`);te&&(te.setAttribute("cx",String(fe)),te.setAttribute("cy",String(he)));const ne=a.querySelector(`text[data-id="${X.id}"]`);ne&&(ne.setAttribute("x",String(fe)),ne.setAttribute("y",String(he+3)))})})},H=new ResizeObserver(Q);return H.observe(e),window.addEventListener("resize",Q),{svg:a,setZoom:d=>{f=Math.max(E,Math.min(r,d)),a.style.transform=`scale(${f/100})`,a.style.transformOrigin="center center"},getZoom:()=>f,destroy:()=>{e.removeEventListener("wheel",y),e.removeEventListener("mousedown",g),window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",_),window.removeEventListener("keydown",L),window.removeEventListener("keyup",Y),window.removeEventListener("resize",Q),H.disconnect()}}}function $e(e,s,l){const i=document.createElement("div");i.className="list-tier";const t=document.createElement("button");t.className="list-tier__header",t.setAttribute("aria-expanded","true");const n=document.createElement("span");n.className="list-tier__title";const p={1:"üå±",2:"üåø",3:"üå≥"};n.textContent=`${p[e]||"üìã"} Tier ${e}`;const u=document.createElement("span");u.className="list-tier__count";const v=s.filter(o=>U(o.id)).length;u.textContent=`${v}/${s.length}`;const c=document.createElement("span");c.className="list-tier__icon",c.textContent="‚ñº",t.appendChild(n),t.appendChild(u),t.appendChild(c);const a=document.createElement("div");a.className="list-tier__content",a.style.display="block";const f=[...s].sort((o,C)=>{const h=U(o.id),x=U(C.id);return h===x?0:h?1:-1}),E=f.filter(o=>!U(o.id)),r=f.filter(o=>U(o.id));if(E.forEach(o=>{const C=Ee(o,l);a.appendChild(C)}),E.length>0&&r.length>0){const o=document.createElement("div");o.className="list-tier__separator",o.textContent="Completed",a.appendChild(o)}return r.forEach(o=>{const C=Ee(o,l);a.appendChild(C)}),t.addEventListener("click",()=>{const o=a.style.display!=="none";a.style.display=o?"none":"block",t.setAttribute("aria-expanded",!o),c.textContent=o?"‚ñ∂":"‚ñº",i.classList.toggle("list-tier--collapsed",o)}),i.appendChild(t),i.appendChild(a),i}function Ee(e,s){const l=U(e.id),t=Z(e.id).status||"unsubmitted",n=document.createElement("div"),p=t==="submitted"?" list-node--pending-evidence":t==="approved"?" list-node--approved-evidence":"";n.className=`list-node ${l?"list-node--completed":""}${p}`,n.setAttribute("data-quest-id",e.id);const u=document.createElement("button");u.className="list-node__main";const v=document.createElement("div");v.className="list-node__left";const c=document.createElement("span");c.className="list-node__emoji",c.textContent=e.emoji||"üçÉ";const a=document.createElement("div");a.className="list-node__info";const f=document.createElement("span");f.className="list-node__title",f.textContent=e.title;const E=document.createElement("span");E.className="list-node__category",E.textContent=e.category,a.appendChild(f),a.appendChild(E),v.appendChild(c),v.appendChild(a);const r=document.createElement("div");if(r.className="list-node__right",e.points){const k=document.createElement("div");k.className="list-node__points",Object.entries(e.points).forEach(([M,T])=>{if(T>0){const m=me()[M]||M,y=document.createElement("span");y.className="list-node__point",y.textContent=`+${T} ${m.substring(0,3)}`,k.appendChild(y)}}),r.appendChild(k)}const o=document.createElement("input");o.type="checkbox",o.className="list-node__checkbox",o.checked=l,o.addEventListener("change",k=>{k.stopPropagation();const M=n.closest(".list-view-container"),T=M?M.scrollTop:0;be(e.id,k.target.checked,e.points||{}),n.classList.toggle("list-node--completed",k.target.checked),M&&T>0&&requestAnimationFrame(()=>{M.scrollTop=T})});const C=document.createElement("span");C.className="list-node__expand",C.textContent="‚ñ∂",r.appendChild(o),r.appendChild(C),u.appendChild(v),u.appendChild(r);const h=document.createElement("div");h.className="list-node__details",h.style.display="none";const x=document.createElement("p");x.className="list-node__description",x.textContent=e.description;const A=document.createElement("div");A.className="list-node__actions";const $=document.createElement("button");return $.className="list-node__action-btn",$.textContent="View Details",$.addEventListener("click",k=>{k.stopPropagation(),s&&s(e)}),A.appendChild($),h.appendChild(x),h.appendChild(A),u.addEventListener("click",()=>{const k=h.style.display!=="none";h.style.display=k?"none":"block",C.textContent=k?"‚ñ∂":"‚ñº",n.classList.toggle("list-node--expanded",!k)}),n.appendChild(u),n.appendChild(h),n}function je(e,s=[]){const l=document.createElement("div");l.className="list-view";let i="all",t=0;const n=l.closest(".list-view-container")||l.parentElement;function p(){n&&(t=n.scrollTop)}function u(){n&&t>0&&requestAnimationFrame(()=>{n.scrollTop=t})}function v(){p(),l.innerHTML="";const c=document.createElement("div");c.className="list-view__filters",[{id:"all",label:"All"},{id:"active",label:"Active"},{id:"completed",label:"Completed"},{id:"in_review",label:"In Review"},{id:"accepted",label:"Accepted"}].forEach(r=>{const o=document.createElement("button");o.className=`list-view__filter ${i===r.id?"list-view__filter--active":""}`,o.textContent=r.label,o.addEventListener("click",()=>{i=r.id,v()}),c.appendChild(o)}),l.appendChild(c);const f=new Map;s.forEach(r=>{f.has(r.tier)||f.set(r.tier,[]),f.get(r.tier).push(r)}),Array.from(f.keys()).sort((r,o)=>r-o).forEach(r=>{const o=f.get(r);let C=o;if(i==="active"?C=o.filter(h=>!U(h.id)):i==="completed"?C=o.filter(h=>U(h.id)):i==="in_review"?C=o.filter(h=>Z(h.id).status==="submitted"):i==="accepted"&&(C=o.filter(h=>Z(h.id).status==="approved")),C.length>0||i==="all"){const x=$e(r,i==="all"?o:C,e);l.appendChild(x)}}),u()}return v(),we(()=>{v()}),l}function ae(e,s){const l=document.createElement("div");l.className="progress-stepper";const i=s?Math.round(e/s*100):0,t=[0,25,50,75,100],n=document.createElement("div");n.className="progress-stepper__bar",t.forEach((u,v)=>{const c=document.createElement("div");c.className="progress-stepper__step";const a=i>=u,f=i>=u&&(v===t.length-1||i<t[v+1]);a&&c.classList.add("progress-stepper__step--reached"),f&&c.classList.add("progress-stepper__step--current");const E=document.createElement("div");E.className="progress-stepper__circle",a?E.textContent="‚úì":E.textContent=u;const r=document.createElement("div");if(r.className="progress-stepper__label",r.textContent=`${u}%`,c.appendChild(E),c.appendChild(r),v<t.length-1){const o=document.createElement("div");o.className="progress-stepper__connector",a&&i>=t[v+1]&&o.classList.add("progress-stepper__connector--filled"),c.appendChild(o)}n.appendChild(c)});const p=document.createElement("div");return p.className="progress-stepper__info",p.textContent=`${e} of ${s} nodes completed`,l.appendChild(n),l.appendChild(p),l}function ie(e,s){const l=document.createElement("div");l.className="settings-menu";const i=document.createElement("button");i.className="settings-menu__button",i.setAttribute("aria-label","Settings menu"),i.setAttribute("aria-expanded","false"),i.textContent="‚ò∞";const t=document.createElement("div");t.className="settings-menu__dropdown",t.style.display="none";const n=document.createElement("button");n.className="settings-menu__item",n.textContent="Export JSON",n.addEventListener("click",()=>{e&&e(),c()});const p=document.createElement("button");p.className="settings-menu__item",p.textContent="Load config JSON",p.addEventListener("click",()=>{const a=document.createElement("input");a.type="file",a.accept="application/json",a.style.display="none",a.addEventListener("change",async()=>{const f=a.files&&a.files[0];if(f)try{const E=await f.text(),r=JSON.parse(E);if(!r.quests||!Array.isArray(r.quests)){window.alert('Invalid config: missing "quests" array.');return}window.localStorage.setItem("skill_tree_custom_config",E),window.location.reload()}catch(E){console.error("Failed to load config JSON",E),window.alert("Failed to load config JSON. Please check the file format.")}}),document.body.appendChild(a),a.click(),a.addEventListener("blur",()=>{a.remove()}),c()});const u=document.createElement("button");u.className="settings-menu__item settings-menu__item--danger",u.textContent="Clear All",u.addEventListener("click",()=>{window.confirm("Reset all completed quests and reflections?")&&s&&s(),c()}),t.appendChild(n),t.appendChild(p),t.appendChild(u);function v(){t.style.display="block",i.setAttribute("aria-expanded","true"),i.classList.add("settings-menu__button--active")}function c(){t.style.display="none",i.setAttribute("aria-expanded","false"),i.classList.remove("settings-menu__button--active")}return i.addEventListener("click",a=>{a.stopPropagation(),t.style.display==="block"?c():v()}),document.addEventListener("click",a=>{l.contains(a.target)||c()}),l.appendChild(i),l.appendChild(t),l}function Ce(){return window.innerWidth<768||window.innerHeight>window.innerWidth}function Ie(e,{quests:s,config:l}){ke();let i=null,t=null,n=Ce()?"list":"tree";function p(){const r={progress:de(),quests:s,config:l,exportedAt:new Date().toISOString()},o=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),C=URL.createObjectURL(o),h=document.createElement("a");h.href=C,h.download=`${l?.appName?.toLowerCase().replace(/\s+/g,"-")||"skill-tree"}-progress.json`,h.click(),URL.revokeObjectURL(C)}function u(r){i&&v(),i=Oe(r,v,()=>{f()}),e.appendChild(i)}function v(){i&&(i.dispatchEvent(new Event("remove")),i.remove(),i=null)}let c=e.querySelector(".fullscreen-container"),a=!0;function f(){const{completedQuests:r}=de(),o=r.length,C=s.length;if(a||!c)e.innerHTML="",c=document.createElement("div"),c.className="fullscreen-container",e.appendChild(c),a=!1;else if(n==="list"){const m=c.querySelector(".overlay-stats");if(m){m.innerHTML="";const g=document.createElement("button");g.className="view-toggle",g.setAttribute("aria-label","Toggle view");const S=document.createElement("span");S.className="view-toggle__icon",S.textContent=n==="tree"?"‚ò∞":"üå≥";const _=document.createElement("span");_.className="view-toggle__label",_.textContent=n==="tree"?"List":"Tree",g.appendChild(S),g.appendChild(_),g.addEventListener("click",()=>{n=n==="tree"?"list":"tree",a=!0,f()});const N=ie(p,()=>{se()}),b=document.createElement("div");b.className="character-stats__toggle",b.appendChild(g),b.appendChild(N);const L=oe(o,C,b);m.appendChild(L)}const y=c.querySelector(".list-view-container");if(y){const g=y.querySelector(".progress-stepper");if(g){const S=ae(o,C);g.replaceWith(S)}}return}else if(n==="tree"){const m=c.querySelector(".overlay-stats");if(m){m.innerHTML="";const g=document.createElement("button");g.className="view-toggle",g.setAttribute("aria-label","Toggle view");const S=document.createElement("span");S.className="view-toggle__icon",S.textContent=n==="tree"?"‚ò∞":"üå≥";const _=document.createElement("span");_.className="view-toggle__label",_.textContent=n==="tree"?"List":"Tree",g.appendChild(S),g.appendChild(_),g.addEventListener("click",()=>{n=n==="tree"?"list":"tree",a=!0,f()});const N=ie(p,()=>{se()}),b=document.createElement("div");b.className="character-stats__toggle",b.appendChild(g),b.appendChild(N);const L=oe(o,C,b);m.appendChild(L)}const y=c.querySelector(".tree-visual-fullscreen");if(y){const g=y.querySelector(".tree-visual__canvas-fullscreen");g&&t&&(t.destroy&&t.destroy(),t=_e(g,r,S=>u(S),(S,_)=>{const N=y.querySelector(".tree-tooltip");if(N&&S&&_){N.style.display="block",N.textContent=`${S.emoji||"üçÉ"} ${S.title}`;const b=N.offsetWidth||150;let L=_.x;L<b/2?L=b/2:L>y.clientWidth-b/2&&(L=y.clientWidth-b/2),N.style.left=`${L}px`,N.style.top=`${Math.max(_.y-8,8)}px`}},()=>{const S=y.querySelector(".tree-tooltip");S&&(S.style.display="none")},s))}return}let h=c.querySelector(".overlay-stats");h?h.innerHTML="":(h=document.createElement("div"),h.className="overlay-stats",c.appendChild(h));const x=document.createElement("button");x.className="view-toggle",x.setAttribute("aria-label","Toggle view");const A=document.createElement("span");A.className="view-toggle__icon",A.textContent=n==="tree"?"‚ò∞":"üå≥";const $=document.createElement("span");$.className="view-toggle__label",$.textContent=n==="tree"?"List":"Tree",x.appendChild(A),x.appendChild($),x.addEventListener("click",()=>{n=n==="tree"?"list":"tree",a=!0,f()});const k=ie(p,()=>{se()}),M=document.createElement("div");M.className="character-stats__toggle",M.appendChild(x),M.appendChild(k);const T=oe(o,C,M);if(h.appendChild(T),n==="tree"){let S=function(_,N){if(g)if(_&&N){g.style.display="block",g.textContent=`${_.emoji||"üçÉ"} ${_.title}`;const b=g.offsetWidth||150;let L=N.x;L<b/2?L=b/2:L>m.clientWidth-b/2&&(L=m.clientWidth-b/2),g.style.left=`${L}px`,g.style.top=`${Math.max(N.y-8,8)}px`}else g.style.display="none"};var P=S;let m=c.querySelector(".tree-visual-fullscreen");if(!m){m=document.createElement("section"),m.className="tree-visual-fullscreen";const _=document.createElement("div");_.className="tree-visual__canvas-fullscreen",m.appendChild(_),c.appendChild(m);const N=document.createElement("div");N.className="tree-tooltip",N.style.display="none",m.appendChild(N)}let y=m.querySelector(".tree-visual__canvas-fullscreen");y||(y=document.createElement("div"),y.className="tree-visual__canvas-fullscreen",m.appendChild(y));const g=m.querySelector(".tree-tooltip");t&&t.destroy&&(t.destroy(),t=null),y.innerHTML="",t=_e(y,r,_=>u(_),(_,N)=>S(_,N),()=>S(null),s)}else{let m=c.querySelector(".list-view-container");if(m){const y=m.querySelector(".progress-stepper");if(y){const g=ae(o,C);y.replaceWith(g)}}else{m=document.createElement("section"),m.className="list-view-container",c.appendChild(m);const y=ae(o,C);m.appendChild(y);const g=je(S=>u(S),s);m.appendChild(g)}}if(n==="tree"){const m=document.createElement("div");m.className="overlay-bottom";const y=document.createElement("div");y.className="overlay-instructions",y.textContent="Scroll to zoom ‚Ä¢ Drag to pan ‚Ä¢ Click nodes for details",m.appendChild(y),c.appendChild(m)}}const E=()=>{Ce()&&n==="tree"&&(n="list",f())};return window.addEventListener("resize",E),f(),we(f),()=>{window.removeEventListener("resize",E),t&&t.destroy&&t.destroy(),i&&v()}}let le=null;async function Re(){if(le)return le;try{let e=null;try{const s=window.localStorage.getItem("skill_tree_custom_config");s&&(e=JSON.parse(s))}catch(s){console.warn("Failed to parse custom config from localStorage, ignoring override",s),e=null}if(!e){const s=await fetch("config.json");if(!s.ok)throw new Error("Failed to load config.json");e=await s.json()}return(!e.quests||!Array.isArray(e.quests))&&(console.warn("config.json missing quests array, using empty array"),e.quests=[]),(!e.statTypes||typeof e.statTypes!="object")&&(console.warn("config.json missing statTypes, using defaults"),e.statTypes={goodness:"Goodness",thoughtfulness:"Thoughtfulness",kindness:"Kindness",empathy:"Empathy"}),(!e.defaultStats||typeof e.defaultStats!="object")&&(console.warn("config.json missing defaultStats, initializing from statTypes"),e.defaultStats={},Object.keys(e.statTypes).forEach(s=>{e.defaultStats[s]=0})),le=e,e}catch(e){return console.error("Failed to load config.json:",e),{appName:"Skill Tree",statTypes:{goodness:"Goodness",thoughtfulness:"Thoughtfulness",kindness:"Kindness",empathy:"Empathy"},defaultStats:{goodness:0,thoughtfulness:0,kindness:0,empathy:0},storageKey:"skill_tree_progress",quests:[]}}}async function Pe(){const e=document.querySelector("#app");if(!e){console.error("App root element not found");return}try{const s=await Re();Le(s);const l=s.quests||[];if(l.length===0){console.warn("No quests found in config.json"),e.innerHTML='<div style="padding: 2rem; text-align: center; color: #e5e7eb;"><h2>No quests found</h2><p>Please ensure config.json contains a "quests" array with at least one quest.</p></div>';return}Ie(e,{config:s,quests:l})}catch(s){console.error("Failed to initialize app:",s),e.innerHTML='<div style="padding: 2rem; text-align: center; color: #e5e7eb;"><h2>Error loading app</h2><p>Please check the console for details.</p></div>'}}Pe();
