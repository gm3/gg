(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function d(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(t){if(t.ep)return;t.ep=!0;const n=d(t);fetch(t.href,n)}})();let ae="skill_tree_progress",ue={},H={},_e={};function Ee(e){ae=e.storageKey||"skill_tree_progress",ue={},Object.keys(e.statTypes||{}).forEach(s=>{ue[s.toUpperCase()]=s}),_e=e.statTypes||{},H=e.defaultStats||{},N={completedQuests:[],lastUpdated:null,reflections:{},stats:{...H}}}function le(){return{..._e}}let N={completedQuests:[],lastUpdated:null,reflections:{},stats:{}};const se=new Set;function Y(){for(const e of se)e(N)}function we(){try{const e=window.localStorage.getItem(ae);if(!e)return N.stats={...H},N;const s=JSON.parse(e);if(!Array.isArray(s.completedQuests))return N.stats={...H},N;N={completedQuests:s.completedQuests,lastUpdated:s.lastUpdated||null,reflections:s.reflections||{},stats:s.stats||{...H}},Y()}catch{N.stats={...H}}return N}function ie(){try{window.localStorage.setItem(ae,JSON.stringify(N))}catch{}}function D(e){return N.completedQuests.includes(e)}function ve(e,s,d={}){const o=N.completedQuests.includes(e),t=new Set(N.completedQuests);if(s&&!o){t.add(e);const n={...N.stats};Object.keys(d).forEach(r=>{n[r]=(n[r]||0)+(d[r]||0)}),N={...N,completedQuests:Array.from(t),stats:n,lastUpdated:new Date().toISOString().slice(0,10)}}else if(!s&&o){t.delete(e);const n={...N.stats};Object.keys(d).forEach(r=>{n[r]=Math.max(0,(n[r]||0)-(d[r]||0))}),N={...N,completedQuests:Array.from(t),stats:n,lastUpdated:new Date().toISOString().slice(0,10)}}ie(),Y()}function oe(){return N}function be(e,s){N={...N,reflections:{...N.reflections,[e]:s},lastUpdated:new Date().toISOString().slice(0,10)},ie(),Y()}function G(){N={completedQuests:[],lastUpdated:new Date().toISOString().slice(0,10),reflections:{},stats:{...H}},ie(),Y()}function Ce(e){return se.add(e),()=>se.delete(e)}function Ne(){return{...N.stats}}function Se(){return Object.values(N.stats).reduce((e,s)=>e+s,0)}function q(e,s,d=null){const o=Ne(),t=Se(),n=document.createElement("div");if(n.className="character-stats",d){const a=document.createElement("div");a.className="character-stats__toggle",a.appendChild(d),n.appendChild(a)}const r=document.createElement("div");r.className="character-stats__bar";const m=document.createElement("div");m.className="character-stats__stat";const g=document.createElement("span");g.className="character-stats__value",g.textContent=`${e}/${s}`;const i=document.createElement("span");i.className="character-stats__label",i.textContent="Nodes",m.appendChild(g),m.appendChild(i),r.appendChild(m);const l=le();Object.entries(o).forEach(([a,y])=>{const C=document.createElement("div");C.className="character-stats__stat";const _=document.createElement("span");_.className="character-stats__value",_.textContent=`+${y}`;const S=document.createElement("span");S.className="character-stats__label",S.textContent=l[a]||a,C.appendChild(_),C.appendChild(S),r.appendChild(C)});const p=document.createElement("div");p.className="character-stats__stat character-stats__stat--total";const v=document.createElement("span");v.className="character-stats__value",v.textContent=t;const c=document.createElement("span");return c.className="character-stats__label",c.textContent="Total",p.appendChild(v),p.appendChild(c),r.appendChild(p),n.appendChild(r),n}function xe(e,s,d){const o=D(e.id),t=document.createElement("div");t.className="node-modal",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true");const n=document.createElement("div");n.className="node-modal__backdrop",n.addEventListener("click",s),t.appendChild(n);const r=document.createElement("div");r.className="node-modal__content";const m=document.createElement("div");m.className="node-modal__header";const g=document.createElement("div");g.className="node-modal__title-row";const i=document.createElement("span");i.className="node-modal__emoji",i.textContent=e.emoji||"üçÉ";const l=document.createElement("h2");l.className="node-modal__title",l.textContent=e.title,g.appendChild(i),g.appendChild(l),m.appendChild(g);const p=document.createElement("button");p.className="node-modal__close",p.textContent="√ó",p.setAttribute("aria-label","Close modal"),p.addEventListener("click",s),m.appendChild(p),r.appendChild(m);const v=document.createElement("div");v.className="node-modal__body";const c=document.createElement("p");c.className="node-modal__description",c.textContent=e.description,v.appendChild(c);const a=document.createElement("div");a.className="node-modal__meta";const y=document.createElement("span");if(y.className="node-modal__category",y.textContent=`${e.category} ‚Ä¢ Tier ${e.tier}`,a.appendChild(y),v.appendChild(a),e.points){const T=document.createElement("div");T.className="node-modal__points";const A=document.createElement("h3");A.className="node-modal__points-title",A.textContent="Points Awarded:",T.appendChild(A);const k=document.createElement("div");k.className="node-modal__points-list";const P=le();Object.entries(e.points).forEach(([f,E])=>{if(E>0){const h=document.createElement("div");h.className="node-modal__point-item";const w=document.createElement("span");w.className="node-modal__point-label",w.textContent=P[f]||f;const b=document.createElement("span");b.className="node-modal__point-value",b.textContent=`+${E}`,h.appendChild(w),h.appendChild(b),k.appendChild(h)}}),T.appendChild(k),v.appendChild(T)}const C=document.createElement("div");C.className="node-modal__toggle";const _=document.createElement("input");_.type="checkbox",_.id=`quest-${e.id}`,_.className="node-modal__checkbox",_.checked=o,_.addEventListener("change",T=>{const A=T.target.checked;ve(e.id,A,e.points||{}),d&&d(),A?r.classList.add("node-modal__content--completed"):r.classList.remove("node-modal__content--completed")});const S=document.createElement("label");if(S.htmlFor=`quest-${e.id}`,S.className="node-modal__checkbox-label",S.textContent=o?"Completed":"Mark as completed",C.appendChild(_),C.appendChild(S),v.appendChild(C),o){const T=document.createElement("div");T.className="node-modal__reflection";const A=document.createElement("label");A.className="node-modal__reflection-label",A.textContent="Reflection (optional):";const k=document.createElement("textarea");k.className="node-modal__reflection-input",k.placeholder="How did this feel? What did you learn?",k.rows=4;const P=oe();P.reflections&&P.reflections[e.id]&&(k.value=P.reflections[e.id]),k.addEventListener("blur",()=>{be(e.id,k.value)}),T.appendChild(A),T.appendChild(k),v.appendChild(T)}r.appendChild(v),t.appendChild(r),o&&r.classList.add("node-modal__content--completed");const $=T=>{T.key==="Escape"&&s()};return document.addEventListener("keydown",$),t.addEventListener("remove",()=>{document.removeEventListener("keydown",$)}),t}function fe(e,s,d,o,t,n=[]){const r=new Set(s);e.innerHTML="";let m=e.clientWidth||window.innerWidth||1e3,g=e.clientHeight||window.innerHeight||800;const i="http://www.w3.org/2000/svg",l=document.createElementNS(i,"svg");l.setAttribute("viewBox",`0 0 ${m} ${g}`),l.setAttribute("class","skill-map");let p=100;const v=50,c=300,a=5,y=Array.from(new Set(n.map(u=>u.tier))).sort((u,R)=>u-R),C=m/2,_=g/2,S=Math.min(m,g),$=S*.18,T=S*.16,A=[];y.forEach((u,R)=>{const W=$+R*T,O=n.filter(j=>j.tier===u),U=O.length||1,B=Math.PI*2/U,I=-Math.PI/2;O.forEach((j,F)=>{const z=I+B*F,K=C+W*Math.cos(z),V=_+W*Math.sin(z);A.push({quest:j,x:K,y:V,tier:u})})}),A.forEach(({quest:u,x:R,y:W})=>{const O=document.createElementNS(i,"circle");O.setAttribute("cx",String(R)),O.setAttribute("cy",String(W)),O.setAttribute("r","10"),O.setAttribute("data-id",u.id),O.setAttribute("data-title",u.title),O.setAttribute("data-description",u.description);const U=r.has(u.id);O.setAttribute("class",U?"skill-map__node skill-map__node--completed":"skill-map__node"),O.addEventListener("click",I=>{I.stopPropagation(),d&&d(u)}),O.addEventListener("mouseenter",I=>{if(o){const j=e.getBoundingClientRect(),F={x:I.clientX-j.left,y:I.clientY-j.top};o(u,F)}}),O.addEventListener("mouseleave",()=>{t&&t()}),O.addEventListener("mousemove",I=>{if(o){const j=e.getBoundingClientRect(),F={x:I.clientX-j.left,y:I.clientY-j.top};o(u,F)}});const B=document.createElementNS(i,"text");B.setAttribute("x",String(R)),B.setAttribute("y",String(W+3)),B.setAttribute("class","skill-map__emoji"),B.setAttribute("data-id",u.id),B.textContent=u.emoji||"üçÉ",l.appendChild(O),l.appendChild(B)}),e.appendChild(l);let k=!1,P={x:0,y:0},f={x:0,y:0};const E=u=>{u.preventDefault();const R=u.deltaY>0?-a:a;p=Math.max(v,Math.min(c,p+R)),x()},h=u=>{(u.button===1||u.button===2||u.button===0&&L)&&(u.preventDefault(),k=!0,P={x:u.clientX-f.x,y:u.clientY-f.y},e.style.cursor="grabbing")},w=u=>{k&&(f={x:u.clientX-P.x,y:u.clientY-P.y},x())},b=()=>{k=!1,e.style.cursor="grab"},x=()=>{const u=p/100;l.style.transform=`translate(${f.x}px, ${f.y}px) scale(${u})`,l.style.transformOrigin="center center"};let L=!1;const M=u=>{(u.key===" "||u.key==="Space")&&(L=!0,e.style.cursor="grab")},ce=u=>{(u.key===" "||u.key==="Space")&&(L=!1,e.style.cursor="")};e.addEventListener("wheel",E,{passive:!1}),e.addEventListener("mousedown",h),window.addEventListener("mousemove",w),window.addEventListener("mouseup",b),window.addEventListener("keydown",M),window.addEventListener("keyup",ce),e.addEventListener("contextmenu",u=>{k&&u.preventDefault()}),e.style.cursor="grab";const J=()=>{m=e.clientWidth||window.innerWidth||1e3,g=e.clientHeight||window.innerHeight||800,l.setAttribute("viewBox",`0 0 ${m} ${g}`),l.setAttribute("width",String(m)),l.setAttribute("height",String(g));const u=m/2,R=g/2,W=Math.min(m,g),O=W*.18,U=W*.16;y.forEach((B,I)=>{const j=O+I*U,F=n.filter(Q=>Q.tier===B),z=F.length||1,K=Math.PI*2/z,V=-Math.PI/2;F.forEach((Q,ye)=>{const de=V+K*ye,pe=u+j*Math.cos(de),me=R+j*Math.sin(de),X=l.querySelector(`circle[data-id="${Q.id}"]`);X&&(X.setAttribute("cx",String(pe)),X.setAttribute("cy",String(me)));const Z=l.querySelector(`text[data-id="${Q.id}"]`);Z&&(Z.setAttribute("x",String(pe)),Z.setAttribute("y",String(me+3)))})})},re=new ResizeObserver(J);return re.observe(e),window.addEventListener("resize",J),{svg:l,setZoom:u=>{p=Math.max(v,Math.min(c,u)),l.style.transform=`scale(${p/100})`,l.style.transformOrigin="center center"},getZoom:()=>p,destroy:()=>{e.removeEventListener("wheel",E),e.removeEventListener("mousedown",h),window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",b),window.removeEventListener("keydown",M),window.removeEventListener("keyup",ce),window.removeEventListener("resize",J),re.disconnect()}}}function Le(e,s,d){const o=document.createElement("div");o.className="list-tier";const t=document.createElement("button");t.className="list-tier__header",t.setAttribute("aria-expanded","true");const n=document.createElement("span");n.className="list-tier__title";const r={1:"üå±",2:"üåø",3:"üå≥"};n.textContent=`${r[e]||"üìã"} Tier ${e}`;const m=document.createElement("span");m.className="list-tier__count";const g=s.filter(a=>D(a.id)).length;m.textContent=`${g}/${s.length}`;const i=document.createElement("span");i.className="list-tier__icon",i.textContent="‚ñº",t.appendChild(n),t.appendChild(m),t.appendChild(i);const l=document.createElement("div");l.className="list-tier__content",l.style.display="block";const p=[...s].sort((a,y)=>{const C=D(a.id),_=D(y.id);return C===_?0:C?1:-1}),v=p.filter(a=>!D(a.id)),c=p.filter(a=>D(a.id));if(v.forEach(a=>{const y=he(a,d);l.appendChild(y)}),v.length>0&&c.length>0){const a=document.createElement("div");a.className="list-tier__separator",a.textContent="Completed",l.appendChild(a)}return c.forEach(a=>{const y=he(a,d);l.appendChild(y)}),t.addEventListener("click",()=>{const a=l.style.display!=="none";l.style.display=a?"none":"block",t.setAttribute("aria-expanded",!a),i.textContent=a?"‚ñ∂":"‚ñº",o.classList.toggle("list-tier--collapsed",a)}),o.appendChild(t),o.appendChild(l),o}function he(e,s){const d=D(e.id),o=document.createElement("div");o.className=`list-node ${d?"list-node--completed":""}`,o.setAttribute("data-quest-id",e.id);const t=document.createElement("button");t.className="list-node__main";const n=document.createElement("div");n.className="list-node__left";const r=document.createElement("span");r.className="list-node__emoji",r.textContent=e.emoji||"üçÉ";const m=document.createElement("div");m.className="list-node__info";const g=document.createElement("span");g.className="list-node__title",g.textContent=e.title;const i=document.createElement("span");i.className="list-node__category",i.textContent=e.category,m.appendChild(g),m.appendChild(i),n.appendChild(r),n.appendChild(m);const l=document.createElement("div");if(l.className="list-node__right",e.points){const _=document.createElement("div");_.className="list-node__points",Object.entries(e.points).forEach(([S,$])=>{if($>0){const A=le()[S]||S,k=document.createElement("span");k.className="list-node__point",k.textContent=`+${$} ${A.substring(0,3)}`,_.appendChild(k)}}),l.appendChild(_)}const p=document.createElement("input");p.type="checkbox",p.className="list-node__checkbox",p.checked=d,p.addEventListener("change",_=>{_.stopPropagation();const S=o.closest(".list-view-container"),$=S?S.scrollTop:0;ve(e.id,_.target.checked,e.points||{}),o.classList.toggle("list-node--completed",_.target.checked),S&&$>0&&requestAnimationFrame(()=>{S.scrollTop=$})});const v=document.createElement("span");v.className="list-node__expand",v.textContent="‚ñ∂",l.appendChild(p),l.appendChild(v),t.appendChild(n),t.appendChild(l);const c=document.createElement("div");c.className="list-node__details",c.style.display="none";const a=document.createElement("p");a.className="list-node__description",a.textContent=e.description;const y=document.createElement("div");y.className="list-node__actions";const C=document.createElement("button");return C.className="list-node__action-btn",C.textContent="View Details",C.addEventListener("click",_=>{_.stopPropagation(),s&&s(e)}),y.appendChild(C),c.appendChild(a),c.appendChild(y),t.addEventListener("click",()=>{const _=c.style.display!=="none";c.style.display=_?"none":"block",v.textContent=_?"‚ñ∂":"‚ñº",o.classList.toggle("list-node--expanded",!_)}),o.appendChild(t),o.appendChild(c),o}function ke(e,s=[]){const d=document.createElement("div");d.className="list-view";let o="all",t=0;const n=d.closest(".list-view-container")||d.parentElement;function r(){n&&(t=n.scrollTop)}function m(){n&&t>0&&requestAnimationFrame(()=>{n.scrollTop=t})}function g(){r(),d.innerHTML="";const i=document.createElement("div");i.className="list-view__filters",[{id:"all",label:"All"},{id:"active",label:"Active"},{id:"completed",label:"Completed"}].forEach(c=>{const a=document.createElement("button");a.className=`list-view__filter ${o===c.id?"list-view__filter--active":""}`,a.textContent=c.label,a.addEventListener("click",()=>{o=c.id,g()}),i.appendChild(a)}),d.appendChild(i);const p=new Map;s.forEach(c=>{p.has(c.tier)||p.set(c.tier,[]),p.get(c.tier).push(c)}),Array.from(p.keys()).sort((c,a)=>c-a).forEach(c=>{const a=p.get(c);let y=a;if(o==="active"?y=a.filter(C=>!D(C.id)):o==="completed"&&(y=a.filter(C=>D(C.id))),y.length>0||o==="all"){const _=Le(c,o==="all"?a:y,e);d.appendChild(_)}}),m()}return g(),Ce(()=>{g()}),d}function ee(e,s){const d=document.createElement("div");d.className="progress-stepper";const o=s?Math.round(e/s*100):0,t=[0,25,50,75,100],n=document.createElement("div");n.className="progress-stepper__bar",t.forEach((m,g)=>{const i=document.createElement("div");i.className="progress-stepper__step";const l=o>=m,p=o>=m&&(g===t.length-1||o<t[g+1]);l&&i.classList.add("progress-stepper__step--reached"),p&&i.classList.add("progress-stepper__step--current");const v=document.createElement("div");v.className="progress-stepper__circle",l?v.textContent="‚úì":v.textContent=m;const c=document.createElement("div");if(c.className="progress-stepper__label",c.textContent=`${m}%`,i.appendChild(v),i.appendChild(c),g<t.length-1){const a=document.createElement("div");a.className="progress-stepper__connector",l&&o>=t[g+1]&&a.classList.add("progress-stepper__connector--filled"),i.appendChild(a)}n.appendChild(i)});const r=document.createElement("div");return r.className="progress-stepper__info",r.textContent=`${e} of ${s} nodes completed`,d.appendChild(n),d.appendChild(r),d}function te(e,s){const d=document.createElement("div");d.className="settings-menu";const o=document.createElement("button");o.className="settings-menu__button",o.setAttribute("aria-label","Settings menu"),o.setAttribute("aria-expanded","false"),o.textContent="‚ò∞";const t=document.createElement("div");t.className="settings-menu__dropdown",t.style.display="none";const n=document.createElement("button");n.className="settings-menu__item",n.textContent="Export JSON",n.addEventListener("click",()=>{e&&e(),i()});const r=document.createElement("button");r.className="settings-menu__item",r.textContent="Load config JSON",r.addEventListener("click",()=>{const l=document.createElement("input");l.type="file",l.accept="application/json",l.style.display="none",l.addEventListener("change",async()=>{const p=l.files&&l.files[0];if(p)try{const v=await p.text(),c=JSON.parse(v);if(!c.quests||!Array.isArray(c.quests)){window.alert('Invalid config: missing "quests" array.');return}window.localStorage.setItem("skill_tree_custom_config",v),window.location.reload()}catch(v){console.error("Failed to load config JSON",v),window.alert("Failed to load config JSON. Please check the file format.")}}),document.body.appendChild(l),l.click(),l.addEventListener("blur",()=>{l.remove()}),i()});const m=document.createElement("button");m.className="settings-menu__item settings-menu__item--danger",m.textContent="Clear All",m.addEventListener("click",()=>{window.confirm("Reset all completed quests and reflections?")&&s&&s(),i()}),t.appendChild(n),t.appendChild(r),t.appendChild(m);function g(){t.style.display="block",o.setAttribute("aria-expanded","true"),o.classList.add("settings-menu__button--active")}function i(){t.style.display="none",o.setAttribute("aria-expanded","false"),o.classList.remove("settings-menu__button--active")}return o.addEventListener("click",l=>{l.stopPropagation(),t.style.display==="block"?i():g()}),document.addEventListener("click",l=>{d.contains(l.target)||i()}),d.appendChild(o),d.appendChild(t),d}function ge(){return window.innerWidth<768||window.innerHeight>window.innerWidth}function Ae(e,{quests:s,config:d}){we();let o=null,t=null,n=ge()?"list":"tree";function r(){const c={progress:oe(),quests:s,config:d,exportedAt:new Date().toISOString()},a=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),y=URL.createObjectURL(a),C=document.createElement("a");C.href=y,C.download=`${d?.appName?.toLowerCase().replace(/\s+/g,"-")||"skill-tree"}-progress.json`,C.click(),URL.revokeObjectURL(y)}function m(c){o&&g(),o=xe(c,g,()=>{p()}),e.appendChild(o)}function g(){o&&(o.dispatchEvent(new Event("remove")),o.remove(),o=null)}let i=e.querySelector(".fullscreen-container"),l=!0;function p(){const{completedQuests:c}=oe(),a=c.length,y=s.length;if(l||!i)e.innerHTML="",i=document.createElement("div"),i.className="fullscreen-container",e.appendChild(i),l=!1;else if(n==="list"){const f=i.querySelector(".overlay-stats");if(f){f.innerHTML="";const h=document.createElement("button");h.className="view-toggle",h.setAttribute("aria-label","Toggle view");const w=document.createElement("span");w.className="view-toggle__icon",w.textContent=n==="tree"?"‚ò∞":"üå≥";const b=document.createElement("span");b.className="view-toggle__label",b.textContent=n==="tree"?"List":"Tree",h.appendChild(w),h.appendChild(b),h.addEventListener("click",()=>{n=n==="tree"?"list":"tree",l=!0,p()});const x=te(r,()=>{G()}),L=document.createElement("div");L.className="character-stats__toggle",L.appendChild(h),L.appendChild(x);const M=q(a,y,L);f.appendChild(M)}const E=i.querySelector(".list-view-container");if(E){const h=E.querySelector(".progress-stepper");if(h){const w=ee(a,y);h.replaceWith(w)}}return}else if(n==="tree"){const f=i.querySelector(".overlay-stats");if(f){f.innerHTML="";const h=document.createElement("button");h.className="view-toggle",h.setAttribute("aria-label","Toggle view");const w=document.createElement("span");w.className="view-toggle__icon",w.textContent=n==="tree"?"‚ò∞":"üå≥";const b=document.createElement("span");b.className="view-toggle__label",b.textContent=n==="tree"?"List":"Tree",h.appendChild(w),h.appendChild(b),h.addEventListener("click",()=>{n=n==="tree"?"list":"tree",l=!0,p()});const x=te(r,()=>{G()}),L=document.createElement("div");L.className="character-stats__toggle",L.appendChild(h),L.appendChild(x);const M=q(a,y,L);f.appendChild(M)}const E=i.querySelector(".tree-visual-fullscreen");if(E){const h=E.querySelector(".tree-visual__canvas-fullscreen");h&&t&&(t.destroy&&t.destroy(),t=fe(h,c,w=>m(w),(w,b)=>{const x=E.querySelector(".tree-tooltip");if(x&&w&&b){x.style.display="block",x.textContent=`${w.emoji||"üçÉ"} ${w.title}`;const L=x.offsetWidth||150;let M=b.x;M<L/2?M=L/2:M>E.clientWidth-L/2&&(M=E.clientWidth-L/2),x.style.left=`${M}px`,x.style.top=`${Math.max(b.y-8,8)}px`}},()=>{const w=E.querySelector(".tree-tooltip");w&&(w.style.display="none")},s))}return}let C=i.querySelector(".overlay-stats");C?C.innerHTML="":(C=document.createElement("div"),C.className="overlay-stats",i.appendChild(C));const _=document.createElement("button");_.className="view-toggle",_.setAttribute("aria-label","Toggle view");const S=document.createElement("span");S.className="view-toggle__icon",S.textContent=n==="tree"?"‚ò∞":"üå≥";const $=document.createElement("span");$.className="view-toggle__label",$.textContent=n==="tree"?"List":"Tree",_.appendChild(S),_.appendChild($),_.addEventListener("click",()=>{n=n==="tree"?"list":"tree",l=!0,p()});const T=te(r,()=>{G()}),A=document.createElement("div");A.className="character-stats__toggle",A.appendChild(_),A.appendChild(T);const k=q(a,y,A);if(C.appendChild(k),n==="tree"){let w=function(b,x){if(h)if(b&&x){h.style.display="block",h.textContent=`${b.emoji||"üçÉ"} ${b.title}`;const L=h.offsetWidth||150;let M=x.x;M<L/2?M=L/2:M>f.clientWidth-L/2&&(M=f.clientWidth-L/2),h.style.left=`${M}px`,h.style.top=`${Math.max(x.y-8,8)}px`}else h.style.display="none"};var P=w;let f=i.querySelector(".tree-visual-fullscreen");if(!f){f=document.createElement("section"),f.className="tree-visual-fullscreen";const b=document.createElement("div");b.className="tree-visual__canvas-fullscreen",f.appendChild(b),i.appendChild(f);const x=document.createElement("div");x.className="tree-tooltip",x.style.display="none",f.appendChild(x)}let E=f.querySelector(".tree-visual__canvas-fullscreen");E||(E=document.createElement("div"),E.className="tree-visual__canvas-fullscreen",f.appendChild(E));const h=f.querySelector(".tree-tooltip");t&&t.destroy&&(t.destroy(),t=null),E.innerHTML="",t=fe(E,c,b=>m(b),(b,x)=>w(b,x),()=>w(null),s)}else{let f=i.querySelector(".list-view-container");if(f){const E=f.querySelector(".progress-stepper");if(E){const h=ee(a,y);E.replaceWith(h)}}else{f=document.createElement("section"),f.className="list-view-container",i.appendChild(f);const E=ee(a,y);f.appendChild(E);const h=ke(w=>m(w),s);f.appendChild(h)}}if(n==="tree"){const f=document.createElement("div");f.className="overlay-bottom";const E=document.createElement("div");E.className="overlay-instructions",E.textContent="Scroll to zoom ‚Ä¢ Drag to pan ‚Ä¢ Click nodes for details",f.appendChild(E),i.appendChild(f)}}const v=()=>{ge()&&n==="tree"&&(n="list",p())};return window.addEventListener("resize",v),p(),Ce(p),()=>{window.removeEventListener("resize",v),t&&t.destroy&&t.destroy(),o&&g()}}let ne=null;async function Te(){if(ne)return ne;try{let e=null;try{const s=window.localStorage.getItem("skill_tree_custom_config");s&&(e=JSON.parse(s))}catch(s){console.warn("Failed to parse custom config from localStorage, ignoring override",s),e=null}if(!e){const s=await fetch("config.json");if(!s.ok)throw new Error("Failed to load config.json");e=await s.json()}return(!e.quests||!Array.isArray(e.quests))&&(console.warn("config.json missing quests array, using empty array"),e.quests=[]),(!e.statTypes||typeof e.statTypes!="object")&&(console.warn("config.json missing statTypes, using defaults"),e.statTypes={goodness:"Goodness",thoughtfulness:"Thoughtfulness",kindness:"Kindness",empathy:"Empathy"}),(!e.defaultStats||typeof e.defaultStats!="object")&&(console.warn("config.json missing defaultStats, initializing from statTypes"),e.defaultStats={},Object.keys(e.statTypes).forEach(s=>{e.defaultStats[s]=0})),ne=e,e}catch(e){return console.error("Failed to load config.json:",e),{appName:"Skill Tree",statTypes:{goodness:"Goodness",thoughtfulness:"Thoughtfulness",kindness:"Kindness",empathy:"Empathy"},defaultStats:{goodness:0,thoughtfulness:0,kindness:0,empathy:0},storageKey:"skill_tree_progress",quests:[]}}}async function Me(){const e=document.querySelector("#app");if(!e){console.error("App root element not found");return}try{const s=await Te();Ee(s);const d=s.quests||[];if(d.length===0){console.warn("No quests found in config.json"),e.innerHTML='<div style="padding: 2rem; text-align: center; color: #e5e7eb;"><h2>No quests found</h2><p>Please ensure config.json contains a "quests" array with at least one quest.</p></div>';return}Ae(e,{config:s,quests:d})}catch(s){console.error("Failed to initialize app:",s),e.innerHTML='<div style="padding: 2rem; text-align: center; color: #e5e7eb;"><h2>Error loading app</h2><p>Please check the console for details.</p></div>'}}Me();
