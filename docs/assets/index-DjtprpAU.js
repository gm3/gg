(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function o(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(t){if(t.ep)return;t.ep=!0;const n=o(t);fetch(t.href,n)}})();const q={LOCAL:"local",REMOTE:"remote"};let de=q.LOCAL;function ke(e={}){e.persistence?.mode===q.REMOTE?de=q.REMOTE:de=q.LOCAL}async function Te(e,s){de===q.REMOTE&&console.warn("[persistence] REMOTE mode selected but no remote saver implemented; saving to localStorage instead.");try{window.localStorage.setItem(e,JSON.stringify(s))}catch{}}let ue="skill_tree_progress",Ee={},W={},Se={};function Ae(e){ue=e.storageKey||"skill_tree_progress",ke(e),Ee={},Object.keys(e.statTypes||{}).forEach(s=>{Ee[s.toUpperCase()]=s}),Se=e.statTypes||{},W=e.defaultStats||{},S={completedQuests:[],lastUpdated:null,reflections:{},evidence:{},stats:{...W}}}function he(){return{...Se}}let S={completedQuests:[],lastUpdated:null,reflections:{},evidence:{},stats:{}};const pe=new Set;function V(){for(const e of pe)e(S)}function Me(){try{const e=window.__skillTreeInitialSnapshot||null;if(!e){const s=window.localStorage.getItem(ue);if(!s)return S.stats={...W},S;const o=JSON.parse(s);return Array.isArray(o.completedQuests)?(S={completedQuests:o.completedQuests,lastUpdated:o.lastUpdated||null,reflections:o.reflections||{},evidence:o.evidence||{},stats:o.stats||{...W}},V(),S):(S.stats={...W},S)}if(!Array.isArray(e.completedQuests))return S.stats={...W},S;S={completedQuests:e.completedQuests,lastUpdated:e.lastUpdated||null,reflections:e.reflections||{},evidence:e.evidence||{},stats:e.stats||{...W}},V()}catch{S.stats={...W}}return S}function ee(){try{Te(ue,S)}catch{}}function H(e){return S.completedQuests.includes(e)}function xe(e,s,o={}){const i=S.completedQuests.includes(e),t=new Set(S.completedQuests);if(s&&!i){t.add(e);const n={...S.stats};Object.keys(o).forEach(h=>{n[h]=(n[h]||0)+(o[h]||0)}),S={...S,completedQuests:Array.from(t),stats:n,lastUpdated:new Date().toISOString().slice(0,10)}}else if(!s&&i){t.delete(e);const n={...S.stats};Object.keys(o).forEach(h=>{n[h]=Math.max(0,(n[h]||0)-(o[h]||0))}),S={...S,completedQuests:Array.from(t),stats:n,lastUpdated:new Date().toISOString().slice(0,10)}}ee(),V()}function me(){return S}function Oe(e,s){S={...S,reflections:{...S.reflections,[e]:s},lastUpdated:new Date().toISOString().slice(0,10)},ee(),V()}function ae(){S={completedQuests:[],lastUpdated:new Date().toISOString().slice(0,10),reflections:{},evidence:{},stats:{...W}},ee(),V()}function G(e){return S.evidence?.[e]||{note:"",status:"unsubmitted"}}function Ce(e,s){const o=S.evidence?.[e]||{note:"",status:"unsubmitted"};S={...S,evidence:{...S.evidence,[e]:{...o,...s}},lastUpdated:new Date().toISOString().slice(0,10)},ee(),V()}function Ne(e){return pe.add(e),()=>pe.delete(e)}function $e(){return{...S.stats}}function Ie(){return Object.values(S.stats).reduce((e,s)=>e+s,0)}function ie(e,s,o=null,i=""){const t=$e(),n=Ie(),h=document.createElement("div");if(h.className="character-stats",o){const v=document.createElement("div");v.className="character-stats__toggle",v.appendChild(o),h.appendChild(v)}if(i){const v=document.createElement("div");v.className="character-stats__tree-name",v.textContent=i,h.appendChild(v)}const u=document.createElement("div");u.className="character-stats__bar";const d=document.createElement("div");d.className="character-stats__stat";const l=document.createElement("span");l.className="character-stats__value",l.textContent=`${e}/${s}`;const c=document.createElement("span");c.className="character-stats__label",c.textContent="Nodes",d.appendChild(l),d.appendChild(c),u.appendChild(d);const E=he();Object.entries(t).forEach(([v,T])=>{const A=document.createElement("div");A.className="character-stats__stat";const p=document.createElement("span");p.className="character-stats__value",p.textContent=`+${T}`;const m=document.createElement("span");m.className="character-stats__label",m.textContent=E[v]||v,A.appendChild(p),A.appendChild(m),u.appendChild(A)});const r=document.createElement("div");r.className="character-stats__stat character-stats__stat--total";const w=document.createElement("span");w.className="character-stats__value",w.textContent=n;const a=document.createElement("span");return a.className="character-stats__label",a.textContent="Total",r.appendChild(w),r.appendChild(a),u.appendChild(r),h.appendChild(u),h}function je(e,s,o){const i=H(e.id),t=document.createElement("div");t.className="node-modal",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true");const n=document.createElement("div");n.className="node-modal__backdrop",n.addEventListener("click",s),t.appendChild(n);const h=document.createElement("div");h.className="node-modal__content";const u=document.createElement("div");u.className="node-modal__header";const d=document.createElement("div");d.className="node-modal__title-row";const l=document.createElement("span");l.className="node-modal__emoji",l.textContent=e.emoji||"üçÉ";const c=document.createElement("h2");c.className="node-modal__title",c.textContent=e.title,d.appendChild(l),d.appendChild(c),u.appendChild(d);const E=document.createElement("button");E.className="node-modal__close",E.textContent="√ó",E.setAttribute("aria-label","Close modal"),E.addEventListener("click",s),u.appendChild(E),h.appendChild(u);const r=document.createElement("div");r.className="node-modal__body";const w=document.createElement("p");w.className="node-modal__description",w.textContent=e.description,r.appendChild(w);const a=document.createElement("div");a.className="node-modal__meta";const v=document.createElement("span");if(v.className="node-modal__category",v.textContent=`${e.category} ‚Ä¢ Tier ${e.tier}`,a.appendChild(v),r.appendChild(a),e.points){const b=document.createElement("div");b.className="node-modal__points";const x=document.createElement("h3");x.className="node-modal__points-title",x.textContent="Points Awarded:",b.appendChild(x);const N=document.createElement("div");N.className="node-modal__points-list";const O=he();Object.entries(e.points).forEach(([X,Y])=>{if(Y>0){const F=document.createElement("div");F.className="node-modal__point-item";const J=document.createElement("span");J.className="node-modal__point-label",J.textContent=O[X]||X;const Q=document.createElement("span");Q.className="node-modal__point-value",Q.textContent=`+${Y}`,F.appendChild(J),F.appendChild(Q),N.appendChild(F)}}),b.appendChild(N),r.appendChild(b)}const T=document.createElement("div");T.className="node-modal__toggle";const A=document.createElement("input");A.type="checkbox",A.id=`quest-${e.id}`,A.className="node-modal__checkbox",A.checked=i,A.addEventListener("change",b=>{const x=b.target.checked;xe(e.id,x,e.points||{}),o&&o(),x?h.classList.add("node-modal__content--completed"):h.classList.remove("node-modal__content--completed")});const p=document.createElement("label");if(p.htmlFor=`quest-${e.id}`,p.className="node-modal__checkbox-label",p.textContent=i?"Completed":"Mark as completed",T.appendChild(A),T.appendChild(p),r.appendChild(T),i){const b=document.createElement("div");b.className="node-modal__reflection";const x=document.createElement("label");x.className="node-modal__reflection-label",x.textContent="Reflection (optional):";const N=document.createElement("textarea");N.className="node-modal__reflection-input",N.placeholder="How did this feel? What did you learn?",N.rows=4;const O=me();O.reflections&&O.reflections[e.id]&&(N.value=O.reflections[e.id]),N.addEventListener("blur",()=>{Oe(e.id,N.value)}),b.appendChild(x),b.appendChild(N),r.appendChild(b)}const m=G(e.id),y=document.createElement("div");y.className="node-modal__evidence";const L=document.createElement("label");L.className="node-modal__evidence-label",L.textContent="Evidence / Attachments (optional):";const M=document.createElement("textarea");M.className="node-modal__evidence-input",M.placeholder="Links to videos, images, files, or notes for a future reviewer.",M.rows=3,M.value=m.note||"",M.addEventListener("blur",()=>{Ce(e.id,{note:M.value})});const $=document.createElement("div");$.className="node-modal__evidence-meta";const f=document.createElement("span");f.className="node-modal__evidence-status";const C=m.status||"unsubmitted";f.textContent=C.toUpperCase(),f.dataset.status=C;const _=document.createElement("button");_.className="node-modal__evidence-submit",_.textContent=m.status==="submitted"?"Resubmit evidence":"Submit for review",_.addEventListener("click",()=>{Ce(e.id,{note:M.value,status:"submitted"}),f.textContent="SUBMITTED",f.dataset.status="submitted",_.textContent="Resubmit evidence"}),$.appendChild(f),$.appendChild(_),y.appendChild(L),y.appendChild(M),y.appendChild($),r.appendChild(y),h.appendChild(r),t.appendChild(h),i&&h.classList.add("node-modal__content--completed");const k=b=>{b.key==="Escape"&&s()};return document.addEventListener("keydown",k),t.addEventListener("remove",()=>{document.removeEventListener("keydown",k)}),t}function ye(e,s,o,i,t,n=[]){const h=new Set(s);e.innerHTML="";let u=e.clientWidth||window.innerWidth||1e3,d=e.clientHeight||window.innerHeight||800;const l="http://www.w3.org/2000/svg",c=document.createElementNS(l,"svg");c.setAttribute("viewBox",`0 0 ${u} ${d}`),c.setAttribute("class","skill-map");let E=100;const r=50,w=300,a=5,v=Array.from(new Set(n.map(g=>g.tier))).sort((g,B)=>g-B),T=u/2,A=d/2,p=Math.min(u,d),m=p*.18,y=p*.16,L=p*.045,M=6;let $=L;const f=[];v.forEach((g,B)=>{const U=m+B*y,I=n.filter(j=>j.tier===g),z=I.length||1,R=Math.PI*2/z,P=-Math.PI/2;if(z>1){const j=Math.PI*2/z,D=2*U*Math.sin(j/2),K=Math.max(M,Math.min(L,D*.6/2));$=Math.min($,K)}I.forEach((j,D)=>{const K=P+R*D,te=T+U*Math.cos(K),ne=A+U*Math.sin(K);f.push({quest:j,x:te,y:ne,tier:g})})}),f.forEach(({quest:g,x:B,y:U})=>{const I=document.createElementNS(l,"circle");I.setAttribute("cx",String(B)),I.setAttribute("cy",String(U)),I.setAttribute("r",String($)),I.setAttribute("data-id",g.id),I.setAttribute("data-title",g.title),I.setAttribute("data-description",g.description);const z=h.has(g.id);I.setAttribute("class",z?"skill-map__node skill-map__node--completed":"skill-map__node"),I.addEventListener("click",P=>{P.stopPropagation(),o&&o(g)}),I.addEventListener("mouseenter",P=>{if(i){const j=e.getBoundingClientRect(),D={x:P.clientX-j.left,y:P.clientY-j.top};i(g,D)}}),I.addEventListener("mouseleave",()=>{t&&t()}),I.addEventListener("mousemove",P=>{if(i){const j=e.getBoundingClientRect(),D={x:P.clientX-j.left,y:P.clientY-j.top};i(g,D)}});const R=document.createElementNS(l,"text");R.setAttribute("x",String(B)),R.setAttribute("y",String(U+$*.15)),R.setAttribute("class","skill-map__emoji"),R.setAttribute("font-size",String($*1.2)),R.setAttribute("data-id",g.id),R.textContent=g.emoji||"üçÉ",c.appendChild(I),c.appendChild(R)}),e.appendChild(c);let C=!1,_={x:0,y:0},k={x:0,y:0};const b=g=>{g.preventDefault();const B=g.deltaY>0?-a:a;E=Math.max(r,Math.min(w,E+B)),X()},x=g=>{(g.button===1||g.button===2||g.button===0&&Y)&&(g.preventDefault(),C=!0,_={x:g.clientX-k.x,y:g.clientY-k.y},e.style.cursor="grabbing")},N=g=>{C&&(k={x:g.clientX-_.x,y:g.clientY-_.y},X())},O=()=>{C=!1,e.style.cursor="grab"},X=()=>{const g=E/100;c.style.transform=`translate(${k.x}px, ${k.y}px) scale(${g})`,c.style.transformOrigin="center center"};let Y=!1;const F=g=>{(g.key===" "||g.key==="Space")&&(Y=!0,e.style.cursor="grab")},J=g=>{(g.key===" "||g.key==="Space")&&(Y=!1,e.style.cursor="")};e.addEventListener("wheel",b,{passive:!1}),e.addEventListener("mousedown",x),window.addEventListener("mousemove",N),window.addEventListener("mouseup",O),window.addEventListener("keydown",F),window.addEventListener("keyup",J),e.addEventListener("contextmenu",g=>{C&&g.preventDefault()}),e.style.cursor="grab";const Q=()=>{u=e.clientWidth||window.innerWidth||1e3,d=e.clientHeight||window.innerHeight||800,c.setAttribute("viewBox",`0 0 ${u} ${d}`),c.setAttribute("width",String(u)),c.setAttribute("height",String(d));const g=u/2,B=d/2,U=Math.min(u,d),I=U*.18,z=U*.16;v.forEach((R,P)=>{const j=I+P*z,D=n.filter(Z=>Z.tier===R),K=D.length||1,te=Math.PI*2/K,ne=-Math.PI/2;D.forEach((Z,Le)=>{const ge=ne+te*Le,ve=g+j*Math.cos(ge),_e=B+j*Math.sin(ge),se=c.querySelector(`circle[data-id="${Z.id}"]`);se&&(se.setAttribute("cx",String(ve)),se.setAttribute("cy",String(_e)));const oe=c.querySelector(`text[data-id="${Z.id}"]`);oe&&(oe.setAttribute("x",String(ve)),oe.setAttribute("y",String(_e+3)))})})},fe=new ResizeObserver(Q);return fe.observe(e),window.addEventListener("resize",Q),{svg:c,setZoom:g=>{E=Math.max(r,Math.min(w,g)),c.style.transform=`scale(${E/100})`,c.style.transformOrigin="center center"},getZoom:()=>E,destroy:()=>{e.removeEventListener("wheel",b),e.removeEventListener("mousedown",x),window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",O),window.removeEventListener("keydown",F),window.removeEventListener("keyup",J),window.removeEventListener("resize",Q),fe.disconnect()}}}function Re(e,s,o){const i=document.createElement("div");i.className="list-tier";const t=document.createElement("button");t.className="list-tier__header",t.setAttribute("aria-expanded","true");const n=document.createElement("span");n.className="list-tier__title";const h={1:"üå±",2:"üåø",3:"üå≥"};n.textContent=`${h[e]||"üìã"} Tier ${e}`;const u=document.createElement("span");u.className="list-tier__count";const d=s.filter(a=>H(a.id)).length;u.textContent=`${d}/${s.length}`;const l=document.createElement("span");l.className="list-tier__icon",l.textContent="‚ñº",t.appendChild(n),t.appendChild(u),t.appendChild(l);const c=document.createElement("div");c.className="list-tier__content",c.style.display="block";const E=[...s].sort((a,v)=>{const T=H(a.id),A=H(v.id);return T===A?0:T?1:-1}),r=E.filter(a=>!H(a.id)),w=E.filter(a=>H(a.id));if(r.forEach(a=>{const v=be(a,o);c.appendChild(v)}),r.length>0&&w.length>0){const a=document.createElement("div");a.className="list-tier__separator",a.textContent="Completed",c.appendChild(a)}return w.forEach(a=>{const v=be(a,o);c.appendChild(v)}),t.addEventListener("click",()=>{const a=c.style.display!=="none";c.style.display=a?"none":"block",t.setAttribute("aria-expanded",!a),l.textContent=a?"‚ñ∂":"‚ñº",i.classList.toggle("list-tier--collapsed",a)}),i.appendChild(t),i.appendChild(c),i}function be(e,s){const o=H(e.id),t=G(e.id).status||"unsubmitted",n=document.createElement("div"),h=t==="submitted"?" list-node--pending-evidence":t==="approved"?" list-node--approved-evidence":"";n.className=`list-node ${o?"list-node--completed":""}${h}`,n.setAttribute("data-quest-id",e.id);const u=document.createElement("button");u.className="list-node__main";const d=document.createElement("div");d.className="list-node__left";const l=document.createElement("span");l.className="list-node__emoji",l.textContent=e.emoji||"üçÉ";const c=document.createElement("div");c.className="list-node__info";const E=document.createElement("span");E.className="list-node__title",E.textContent=e.title;const r=document.createElement("span");r.className="list-node__category",r.textContent=e.category,c.appendChild(E),c.appendChild(r),d.appendChild(l),d.appendChild(c);const w=document.createElement("div");if(w.className="list-node__right",e.points){const y=document.createElement("div");y.className="list-node__points",Object.entries(e.points).forEach(([L,M])=>{if(M>0){const f=he()[L]||L,C=document.createElement("span");C.className="list-node__point",C.textContent=`+${M} ${f.substring(0,3)}`,y.appendChild(C)}}),w.appendChild(y)}const a=document.createElement("input");a.type="checkbox",a.className="list-node__checkbox",a.checked=o,a.addEventListener("change",y=>{y.stopPropagation();const L=n.closest(".list-view-container"),M=L?L.scrollTop:0;xe(e.id,y.target.checked,e.points||{}),n.classList.toggle("list-node--completed",y.target.checked),L&&M>0&&requestAnimationFrame(()=>{L.scrollTop=M})});const v=document.createElement("span");v.className="list-node__expand",v.textContent="‚ñ∂",w.appendChild(a),w.appendChild(v),u.appendChild(d),u.appendChild(w);const T=document.createElement("div");T.className="list-node__details",T.style.display="none";const A=document.createElement("p");A.className="list-node__description",A.textContent=e.description;const p=document.createElement("div");p.className="list-node__actions";const m=document.createElement("button");return m.className="list-node__action-btn",m.textContent="View Details",m.addEventListener("click",y=>{y.stopPropagation(),s&&s(e)}),p.appendChild(m),T.appendChild(A),T.appendChild(p),u.addEventListener("click",()=>{const y=T.style.display!=="none";T.style.display=y?"none":"block",v.textContent=y?"‚ñ∂":"‚ñº",n.classList.toggle("list-node--expanded",!y)}),n.appendChild(u),n.appendChild(T),n}function Pe(e,s=[]){const o=document.createElement("div");o.className="list-view";let i="all",t=0;function n(){const d=o.closest(".list-view-container")||o.parentElement;d&&(t=d.scrollTop)}function h(){const d=o.closest(".list-view-container")||o.parentElement;d&&t>0&&requestAnimationFrame(()=>{d.scrollTop=t})}function u(){n();const d=new Set,l=new Set;o.querySelectorAll(".list-tier").forEach(p=>{const m=p.querySelector(".list-tier__header"),y=m&&m.querySelector(".list-tier__title"),M=(y&&y.textContent||"").match(/Tier (\d+)/),$=M?parseInt(M[1],10):null;$&&m&&m.getAttribute("aria-expanded")==="false"&&d.add($)}),o.querySelectorAll(".list-node.list-node--expanded").forEach(p=>{const m=p.getAttribute("data-quest-id");m&&l.add(m)}),o.innerHTML="";const r=document.createElement("div");r.className="list-view__filters",[{id:"all",label:"All"},{id:"active",label:"Active"},{id:"completed",label:"Completed"},{id:"in_review",label:"In Review"},{id:"accepted",label:"Accepted"}].forEach(p=>{const m=document.createElement("button");m.className=`list-view__filter ${i===p.id?"list-view__filter--active":""}`,m.textContent=p.label,m.addEventListener("click",()=>{i=p.id,u()}),r.appendChild(m)}),o.appendChild(r);const a=new Map;s.forEach(p=>{a.has(p.tier)||a.set(p.tier,[]),a.get(p.tier).push(p)}),Array.from(a.keys()).sort((p,m)=>p-m).forEach(p=>{const m=a.get(p);let y=m;if(i==="active"?y=m.filter(L=>!H(L.id)):i==="completed"?y=m.filter(L=>H(L.id)):i==="in_review"?y=m.filter(L=>G(L.id).status==="submitted"):i==="accepted"&&(y=m.filter(L=>G(L.id).status==="approved")),y.length>0||i==="all"){const M=Re(p,i==="all"?m:y,e);o.appendChild(M)}}),o.querySelectorAll(".list-tier").forEach(p=>{const m=p.querySelector(".list-tier__header"),y=m&&m.querySelector(".list-tier__title"),M=(y&&y.textContent||"").match(/Tier (\d+)/),$=M?parseInt(M[1],10):null;if($&&d.has($)){const f=p.querySelector(".list-tier__content"),C=p.querySelector(".list-tier__icon");f&&(f.style.display="none"),m&&m.setAttribute("aria-expanded","false"),C&&(C.textContent="‚ñ∂"),p.classList.add("list-tier--collapsed")}}),o.querySelectorAll(".list-node").forEach(p=>{const m=p.getAttribute("data-quest-id");if(m&&l.has(m)){const y=p.querySelector(".list-node__details"),L=p.querySelector(".list-node__expand");y&&(y.style.display="block"),L&&(L.textContent="‚ñº"),p.classList.add("list-node--expanded")}}),h()}return u(),Ne(()=>{u()}),o}function le(e,s){const o=document.createElement("div");o.className="progress-stepper";const i=s?Math.round(e/s*100):0,t=[0,25,50,75,100],n=document.createElement("div");n.className="progress-stepper__bar",t.forEach((u,d)=>{const l=document.createElement("div");l.className="progress-stepper__step";const c=i>=u,E=i>=u&&(d===t.length-1||i<t[d+1]);c&&l.classList.add("progress-stepper__step--reached"),E&&l.classList.add("progress-stepper__step--current");const r=document.createElement("div");r.className="progress-stepper__circle",c?r.textContent="‚úì":r.textContent=u;const w=document.createElement("div");if(w.className="progress-stepper__label",w.textContent=`${u}%`,l.appendChild(r),l.appendChild(w),d<t.length-1){const a=document.createElement("div");a.className="progress-stepper__connector",c&&i>=t[d+1]&&a.classList.add("progress-stepper__connector--filled"),l.appendChild(a)}n.appendChild(l)});const h=document.createElement("div");return h.className="progress-stepper__info",h.textContent=`${e} of ${s} nodes completed`,o.appendChild(n),o.appendChild(h),o}function ce(e,s){const o=document.createElement("div");o.className="settings-menu";const i=document.createElement("button");i.className="settings-menu__button",i.setAttribute("aria-label","Settings menu"),i.setAttribute("aria-expanded","false"),i.textContent="‚ò∞";const t=document.createElement("div");t.className="settings-menu__dropdown",t.style.display="none";const n=document.createElement("button");n.className="settings-menu__item",n.textContent="Export JSON",n.addEventListener("click",()=>{e&&e(),E()});const h=document.createElement("button");h.className="settings-menu__item",h.textContent="Load config JSON",h.addEventListener("click",()=>{const r=document.createElement("input");r.type="file",r.accept="application/json",r.style.display="none",r.addEventListener("change",async()=>{const w=r.files&&r.files[0];if(w)try{const a=await w.text(),v=JSON.parse(a);if(!v.quests||!Array.isArray(v.quests)){window.alert('Invalid config: missing "quests" array.');return}window.localStorage.setItem("skill_tree_custom_config",a),window.location.reload()}catch(a){console.error("Failed to load config JSON",a),window.alert("Failed to load config JSON. Please check the file format.")}}),document.body.appendChild(r),r.click(),r.addEventListener("blur",()=>{r.remove()}),E()});const u=document.createElement("button");u.className="settings-menu__item",u.textContent="Open demo site",u.addEventListener("click",()=>{window.open("https://gm3.github.io/gg/","_blank"),E()});const d=document.createElement("button");d.className="settings-menu__item",d.textContent="Open GitHub repo",d.addEventListener("click",()=>{window.open("https://github.com/gm3/gg","_blank"),E()});const l=document.createElement("button");l.className="settings-menu__item settings-menu__item--danger",l.textContent="Clear All",l.addEventListener("click",()=>{window.confirm("Reset all completed quests and reflections?")&&s&&s(),E()}),t.appendChild(n),t.appendChild(h),t.appendChild(u),t.appendChild(d),t.appendChild(l);function c(){t.style.display="block",i.setAttribute("aria-expanded","true"),i.classList.add("settings-menu__button--active")}function E(){t.style.display="none",i.setAttribute("aria-expanded","false"),i.classList.remove("settings-menu__button--active")}return i.addEventListener("click",r=>{r.stopPropagation(),t.style.display==="block"?E():c()}),document.addEventListener("click",r=>{o.contains(r.target)||E()}),o.appendChild(i),o.appendChild(t),o}function we(){return window.innerWidth<768||window.innerHeight>window.innerWidth}function Be(e,{quests:s,config:o}){Me();let i=null,t=null,n=we()?"list":"tree";function h(){const w={progress:me(),quests:s,config:o,exportedAt:new Date().toISOString()},a=new Blob([JSON.stringify(w,null,2)],{type:"application/json"}),v=URL.createObjectURL(a),T=document.createElement("a");T.href=v,T.download=`${o?.appName?.toLowerCase().replace(/\s+/g,"-")||"skill-tree"}-progress.json`,T.click(),URL.revokeObjectURL(v)}function u(w){i&&d(),i=je(w,d,()=>{E()}),e.appendChild(i)}function d(){i&&(i.dispatchEvent(new Event("remove")),i.remove(),i=null)}let l=e.querySelector(".fullscreen-container"),c=!0;function E(){const{completedQuests:w}=me(),a=w.length,v=s.length;if(c||!l)e.innerHTML="",l=document.createElement("div"),l.className="fullscreen-container",e.appendChild(l),c=!1;else if(n==="list"){const f=l.querySelector(".overlay-stats");if(f){f.innerHTML="";const _=document.createElement("button");_.className="view-toggle",_.setAttribute("aria-label","Toggle view");const k=document.createElement("span");k.className="view-toggle__icon",k.textContent=n==="tree"?"‚ò∞":"üå≥";const b=document.createElement("span");b.className="view-toggle__label",b.textContent=n==="tree"?"List":"Tree",_.appendChild(k),_.appendChild(b),_.addEventListener("click",()=>{n=n==="tree"?"list":"tree",c=!0,E()});const x=ce(h,()=>{ae()}),N=document.createElement("div");N.className="character-stats__toggle",N.appendChild(_),N.appendChild(x);const O=ie(a,v,N,o?.appName||"Skill Tree");f.appendChild(O)}const C=l.querySelector(".list-view-container");if(C){const _=C.querySelector(".progress-stepper");if(_){const k=le(a,v);_.replaceWith(k)}}return}else if(n==="tree"){const f=l.querySelector(".overlay-stats");if(f){f.innerHTML="";const _=document.createElement("button");_.className="view-toggle",_.setAttribute("aria-label","Toggle view");const k=document.createElement("span");k.className="view-toggle__icon",k.textContent=n==="tree"?"‚ò∞":"üå≥";const b=document.createElement("span");b.className="view-toggle__label",b.textContent=n==="tree"?"List":"Tree",_.appendChild(k),_.appendChild(b),_.addEventListener("click",()=>{n=n==="tree"?"list":"tree",c=!0,E()});const x=ce(h,()=>{ae()}),N=document.createElement("div");N.className="character-stats__toggle",N.appendChild(_),N.appendChild(x);const O=ie(a,v,N,o?.appName||"Skill Tree");f.appendChild(O)}const C=l.querySelector(".tree-visual-fullscreen");if(C){const _=C.querySelector(".tree-visual__canvas-fullscreen");_&&t&&(t.destroy&&t.destroy(),t=ye(_,w,k=>u(k),(k,b)=>{const x=C.querySelector(".tree-tooltip");if(x&&k&&b){x.style.display="block",x.textContent=`${k.emoji||"üçÉ"} ${k.title}`;const N=x.offsetWidth||150;let O=b.x;O<N/2?O=N/2:O>C.clientWidth-N/2&&(O=C.clientWidth-N/2),x.style.left=`${O}px`,x.style.top=`${Math.max(b.y-8,8)}px`}},()=>{const k=C.querySelector(".tree-tooltip");k&&(k.style.display="none")},s))}return}let T=l.querySelector(".overlay-stats");T?T.innerHTML="":(T=document.createElement("div"),T.className="overlay-stats",l.appendChild(T));const A=document.createElement("button");A.className="view-toggle",A.setAttribute("aria-label","Toggle view");const p=document.createElement("span");p.className="view-toggle__icon",p.textContent=n==="tree"?"‚ò∞":"üå≥";const m=document.createElement("span");m.className="view-toggle__label",m.textContent=n==="tree"?"List":"Tree",A.appendChild(p),A.appendChild(m),A.addEventListener("click",()=>{n=n==="tree"?"list":"tree",c=!0,E()});const y=ce(h,()=>{ae()}),L=document.createElement("div");L.className="character-stats__toggle",L.appendChild(A),L.appendChild(y);const M=ie(a,v,L,o?.appName||"Skill Tree");if(T.appendChild(M),n==="tree"){let k=function(b,x){if(_)if(b&&x){_.style.display="block",_.textContent=`${b.emoji||"üçÉ"} ${b.title}`;const N=_.offsetWidth||150;let O=x.x;O<N/2?O=N/2:O>f.clientWidth-N/2&&(O=f.clientWidth-N/2),_.style.left=`${O}px`,_.style.top=`${Math.max(x.y-8,8)}px`}else _.style.display="none"};var $=k;let f=l.querySelector(".tree-visual-fullscreen");if(!f){f=document.createElement("section"),f.className="tree-visual-fullscreen";const b=document.createElement("div");b.className="tree-visual__canvas-fullscreen",f.appendChild(b),l.appendChild(f);const x=document.createElement("div");x.className="tree-tooltip",x.style.display="none",f.appendChild(x)}let C=f.querySelector(".tree-visual__canvas-fullscreen");C||(C=document.createElement("div"),C.className="tree-visual__canvas-fullscreen",f.appendChild(C));const _=f.querySelector(".tree-tooltip");t&&t.destroy&&(t.destroy(),t=null),C.innerHTML="",t=ye(C,w,b=>u(b),(b,x)=>k(b,x),()=>k(null),s)}else{let f=l.querySelector(".list-view-container");if(f){const C=f.querySelector(".progress-stepper");if(C){const _=le(a,v);C.replaceWith(_)}}else{f=document.createElement("section"),f.className="list-view-container",l.appendChild(f);const C=le(a,v);f.appendChild(C);const _=Pe(k=>u(k),s);f.appendChild(_)}}if(n==="tree"){const f=document.createElement("div");f.className="overlay-bottom";const C=document.createElement("div");C.className="overlay-instructions",C.textContent="Scroll to zoom ‚Ä¢ Drag to pan ‚Ä¢ Click nodes for details",f.appendChild(C),l.appendChild(f)}}const r=()=>{we()&&n==="tree"&&(n="list",E())};return window.addEventListener("resize",r),E(),Ne(E),()=>{window.removeEventListener("resize",r),t&&t.destroy&&t.destroy(),i&&d()}}let re=null;async function De(){if(re)return re;try{let e=null;try{const s=window.localStorage.getItem("skill_tree_custom_config");s&&(e=JSON.parse(s))}catch(s){console.warn("Failed to parse custom config from localStorage, ignoring override",s),e=null}if(!e){const s=await fetch("config.json");if(!s.ok)throw new Error("Failed to load config.json");e=await s.json()}return(!e.quests||!Array.isArray(e.quests))&&(console.warn("config.json missing quests array, using empty array"),e.quests=[]),(!e.statTypes||typeof e.statTypes!="object")&&(console.warn("config.json missing statTypes, using defaults"),e.statTypes={goodness:"Goodness",thoughtfulness:"Thoughtfulness",kindness:"Kindness",empathy:"Empathy"}),(!e.defaultStats||typeof e.defaultStats!="object")&&(console.warn("config.json missing defaultStats, initializing from statTypes"),e.defaultStats={},Object.keys(e.statTypes).forEach(s=>{e.defaultStats[s]=0})),re=e,e}catch(e){return console.error("Failed to load config.json:",e),{appName:"Skill Tree",statTypes:{goodness:"Goodness",thoughtfulness:"Thoughtfulness",kindness:"Kindness",empathy:"Empathy"},defaultStats:{goodness:0,thoughtfulness:0,kindness:0,empathy:0},storageKey:"skill_tree_progress",quests:[]}}}async function Ue(){const e=document.querySelector("#app");if(!e){console.error("App root element not found");return}try{const s=await De();Ae(s);const o=s.quests||[];if(o.length===0){console.warn("No quests found in config.json"),e.innerHTML='<div style="padding: 2rem; text-align: center; color: #e5e7eb;"><h2>No quests found</h2><p>Please ensure config.json contains a "quests" array with at least one quest.</p></div>';return}Be(e,{config:s,quests:o})}catch(s){console.error("Failed to initialize app:",s),e.innerHTML='<div style="padding: 2rem; text-align: center; color: #e5e7eb;"><h2>Error loading app</h2><p>Please check the console for details.</p></div>'}}Ue();
