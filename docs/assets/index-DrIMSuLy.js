(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function i(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(t){if(t.ep)return;t.ep=!0;const n=i(t);fetch(t.href,n)}})();const K={LOCAL:"local",REMOTE:"remote"};let ce=K.LOCAL;function Se(e={}){e.persistence?.mode===K.REMOTE?ce=K.REMOTE:ce=K.LOCAL}async function xe(e,o){ce===K.REMOTE&&console.warn("[persistence] REMOTE mode selected but no remote saver implemented; saving to localStorage instead.");try{window.localStorage.setItem(e,JSON.stringify(o))}catch{}}let pe="skill_tree_progress",ge={},D={},ye={};function Le(e){pe=e.storageKey||"skill_tree_progress",Se(e),ge={},Object.keys(e.statTypes||{}).forEach(o=>{ge[o.toUpperCase()]=o}),ye=e.statTypes||{},D=e.defaultStats||{},w={completedQuests:[],lastUpdated:null,reflections:{},evidence:{},stats:{...D}}}function me(){return{...ye}}let w={completedQuests:[],lastUpdated:null,reflections:{},evidence:{},stats:{}};const re=new Set;function z(){for(const e of re)e(w)}function ke(){try{const e=window.__skillTreeInitialSnapshot||null;if(!e){const o=window.localStorage.getItem(pe);if(!o)return w.stats={...D},w;const i=JSON.parse(o);return Array.isArray(i.completedQuests)?(w={completedQuests:i.completedQuests,lastUpdated:i.lastUpdated||null,reflections:i.reflections||{},evidence:i.evidence||{},stats:i.stats||{...D}},z(),w):(w.stats={...D},w)}if(!Array.isArray(e.completedQuests))return w.stats={...D},w;w={completedQuests:e.completedQuests,lastUpdated:e.lastUpdated||null,reflections:e.reflections||{},evidence:e.evidence||{},stats:e.stats||{...D}},z()}catch{w.stats={...D}}return w}function G(){try{xe(pe,w)}catch{}}function U(e){return w.completedQuests.includes(e)}function be(e,o,i={}){const a=w.completedQuests.includes(e),t=new Set(w.completedQuests);if(o&&!a){t.add(e);const n={...w.stats};Object.keys(i).forEach(u=>{n[u]=(n[u]||0)+(i[u]||0)}),w={...w,completedQuests:Array.from(t),stats:n,lastUpdated:new Date().toISOString().slice(0,10)}}else if(!o&&a){t.delete(e);const n={...w.stats};Object.keys(i).forEach(u=>{n[u]=Math.max(0,(n[u]||0)-(i[u]||0))}),w={...w,completedQuests:Array.from(t),stats:n,lastUpdated:new Date().toISOString().slice(0,10)}}G(),z()}function de(){return w}function Te(e,o){w={...w,reflections:{...w.reflections,[e]:o},lastUpdated:new Date().toISOString().slice(0,10)},G(),z()}function se(){w={completedQuests:[],lastUpdated:new Date().toISOString().slice(0,10),reflections:{},evidence:{},stats:{...D}},G(),z()}function Z(e){return w.evidence?.[e]||{note:"",status:"unsubmitted"}}function ve(e,o){const i=w.evidence?.[e]||{note:"",status:"unsubmitted"};w={...w,evidence:{...w.evidence,[e]:{...i,...o}},lastUpdated:new Date().toISOString().slice(0,10)},G(),z()}function we(e){return re.add(e),()=>re.delete(e)}function Ae(){return{...w.stats}}function Me(){return Object.values(w.stats).reduce((e,o)=>e+o,0)}function oe(e,o,i=null,a=""){const t=Ae(),n=Me(),u=document.createElement("div");if(u.className="character-stats",i){const d=document.createElement("div");d.className="character-stats__toggle",d.appendChild(i),u.appendChild(d)}if(a){const d=document.createElement("div");d.className="character-stats__tree-name",d.textContent=a,u.appendChild(d)}const h=document.createElement("div");h.className="character-stats__bar";const v=document.createElement("div");v.className="character-stats__stat";const l=document.createElement("span");l.className="character-stats__value",l.textContent=`${e}/${o}`;const c=document.createElement("span");c.className="character-stats__label",c.textContent="Nodes",v.appendChild(l),v.appendChild(c),h.appendChild(v);const g=me();Object.entries(t).forEach(([d,E])=>{const x=document.createElement("div");x.className="character-stats__stat";const A=document.createElement("span");A.className="character-stats__value",A.textContent=`+${E}`;const O=document.createElement("span");O.className="character-stats__label",O.textContent=g[d]||d,x.appendChild(A),x.appendChild(O),h.appendChild(x)});const p=document.createElement("div");p.className="character-stats__stat character-stats__stat--total";const r=document.createElement("span");r.className="character-stats__value",r.textContent=n;const s=document.createElement("span");return s.className="character-stats__label",s.textContent="Total",p.appendChild(r),p.appendChild(s),h.appendChild(p),u.appendChild(h),u}function Oe(e,o,i){const a=U(e.id),t=document.createElement("div");t.className="node-modal",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true");const n=document.createElement("div");n.className="node-modal__backdrop",n.addEventListener("click",o),t.appendChild(n);const u=document.createElement("div");u.className="node-modal__content";const h=document.createElement("div");h.className="node-modal__header";const v=document.createElement("div");v.className="node-modal__title-row";const l=document.createElement("span");l.className="node-modal__emoji",l.textContent=e.emoji||"üçÉ";const c=document.createElement("h2");c.className="node-modal__title",c.textContent=e.title,v.appendChild(l),v.appendChild(c),h.appendChild(v);const g=document.createElement("button");g.className="node-modal__close",g.textContent="√ó",g.setAttribute("aria-label","Close modal"),g.addEventListener("click",o),h.appendChild(g),u.appendChild(h);const p=document.createElement("div");p.className="node-modal__body";const r=document.createElement("p");r.className="node-modal__description",r.textContent=e.description,p.appendChild(r);const s=document.createElement("div");s.className="node-modal__meta";const d=document.createElement("span");if(d.className="node-modal__category",d.textContent=`${e.category} ‚Ä¢ Tier ${e.tier}`,s.appendChild(d),p.appendChild(s),e.points){const C=document.createElement("div");C.className="node-modal__points";const N=document.createElement("h3");N.className="node-modal__points-title",N.textContent="Points Awarded:",C.appendChild(N);const b=document.createElement("div");b.className="node-modal__points-list";const L=me();Object.entries(e.points).forEach(([Y,Q])=>{if(Q>0){const F=document.createElement("div");F.className="node-modal__point-item";const m=document.createElement("span");m.className="node-modal__point-label",m.textContent=L[Y]||Y;const j=document.createElement("span");j.className="node-modal__point-value",j.textContent=`+${Q}`,F.appendChild(m),F.appendChild(j),b.appendChild(F)}}),C.appendChild(b),p.appendChild(C)}const E=document.createElement("div");E.className="node-modal__toggle";const x=document.createElement("input");x.type="checkbox",x.id=`quest-${e.id}`,x.className="node-modal__checkbox",x.checked=a,x.addEventListener("change",C=>{const N=C.target.checked;be(e.id,N,e.points||{}),i&&i(),N?u.classList.add("node-modal__content--completed"):u.classList.remove("node-modal__content--completed")});const A=document.createElement("label");if(A.htmlFor=`quest-${e.id}`,A.className="node-modal__checkbox-label",A.textContent=a?"Completed":"Mark as completed",E.appendChild(x),E.appendChild(A),p.appendChild(E),a){const C=document.createElement("div");C.className="node-modal__reflection";const N=document.createElement("label");N.className="node-modal__reflection-label",N.textContent="Reflection (optional):";const b=document.createElement("textarea");b.className="node-modal__reflection-input",b.placeholder="How did this feel? What did you learn?",b.rows=4;const L=de();L.reflections&&L.reflections[e.id]&&(b.value=L.reflections[e.id]),b.addEventListener("blur",()=>{Te(e.id,b.value)}),C.appendChild(N),C.appendChild(b),p.appendChild(C)}const O=Z(e.id),k=document.createElement("div");k.className="node-modal__evidence";const M=document.createElement("label");M.className="node-modal__evidence-label",M.textContent="Evidence / Attachments (optional):";const T=document.createElement("textarea");T.className="node-modal__evidence-input",T.placeholder="Links to videos, images, files, or notes for a future reviewer.",T.rows=3,T.value=O.note||"",T.addEventListener("blur",()=>{ve(e.id,{note:T.value})});const P=document.createElement("div");P.className="node-modal__evidence-meta";const f=document.createElement("span");f.className="node-modal__evidence-status";const y=O.status||"unsubmitted";f.textContent=y.toUpperCase(),f.dataset.status=y;const _=document.createElement("button");_.className="node-modal__evidence-submit",_.textContent=O.status==="submitted"?"Resubmit evidence":"Submit for review",_.addEventListener("click",()=>{ve(e.id,{note:T.value,status:"submitted"}),f.textContent="SUBMITTED",f.dataset.status="submitted",_.textContent="Resubmit evidence"}),P.appendChild(f),P.appendChild(_),k.appendChild(M),k.appendChild(T),k.appendChild(P),p.appendChild(k),u.appendChild(p),t.appendChild(u),a&&u.classList.add("node-modal__content--completed");const S=C=>{C.key==="Escape"&&o()};return document.addEventListener("keydown",S),t.addEventListener("remove",()=>{document.removeEventListener("keydown",S)}),t}function _e(e,o,i,a,t,n=[]){const u=new Set(o);e.innerHTML="";let h=e.clientWidth||window.innerWidth||1e3,v=e.clientHeight||window.innerHeight||800;const l="http://www.w3.org/2000/svg",c=document.createElementNS(l,"svg");c.setAttribute("viewBox",`0 0 ${h} ${v}`),c.setAttribute("class","skill-map");let g=100;const p=50,r=300,s=5,d=Array.from(new Set(n.map(m=>m.tier))).sort((m,j)=>m-j),E=h/2,x=v/2,A=Math.min(h,v),O=A*.18,k=A*.16,M=[];d.forEach((m,j)=>{const W=O+j*k,$=n.filter(I=>I.tier===m),J=$.length||1,B=Math.PI*2/J,R=-Math.PI/2;$.forEach((I,H)=>{const V=R+B*H,q=E+W*Math.cos(V),ee=x+W*Math.sin(V);M.push({quest:I,x:q,y:ee,tier:m})})}),M.forEach(({quest:m,x:j,y:W})=>{const $=document.createElementNS(l,"circle");$.setAttribute("cx",String(j)),$.setAttribute("cy",String(W)),$.setAttribute("r","10"),$.setAttribute("data-id",m.id),$.setAttribute("data-title",m.title),$.setAttribute("data-description",m.description);const J=u.has(m.id);$.setAttribute("class",J?"skill-map__node skill-map__node--completed":"skill-map__node"),$.addEventListener("click",R=>{R.stopPropagation(),i&&i(m)}),$.addEventListener("mouseenter",R=>{if(a){const I=e.getBoundingClientRect(),H={x:R.clientX-I.left,y:R.clientY-I.top};a(m,H)}}),$.addEventListener("mouseleave",()=>{t&&t()}),$.addEventListener("mousemove",R=>{if(a){const I=e.getBoundingClientRect(),H={x:R.clientX-I.left,y:R.clientY-I.top};a(m,H)}});const B=document.createElementNS(l,"text");B.setAttribute("x",String(j)),B.setAttribute("y",String(W+3)),B.setAttribute("class","skill-map__emoji"),B.setAttribute("data-id",m.id),B.textContent=m.emoji||"üçÉ",c.appendChild($),c.appendChild(B)}),e.appendChild(c);let T=!1,P={x:0,y:0},f={x:0,y:0};const y=m=>{m.preventDefault();const j=m.deltaY>0?-s:s;g=Math.max(p,Math.min(r,g+j)),N()},_=m=>{(m.button===1||m.button===2||m.button===0&&b)&&(m.preventDefault(),T=!0,P={x:m.clientX-f.x,y:m.clientY-f.y},e.style.cursor="grabbing")},S=m=>{T&&(f={x:m.clientX-P.x,y:m.clientY-P.y},N())},C=()=>{T=!1,e.style.cursor="grab"},N=()=>{const m=g/100;c.style.transform=`translate(${f.x}px, ${f.y}px) scale(${m})`,c.style.transformOrigin="center center"};let b=!1;const L=m=>{(m.key===" "||m.key==="Space")&&(b=!0,e.style.cursor="grab")},Y=m=>{(m.key===" "||m.key==="Space")&&(b=!1,e.style.cursor="")};e.addEventListener("wheel",y,{passive:!1}),e.addEventListener("mousedown",_),window.addEventListener("mousemove",S),window.addEventListener("mouseup",C),window.addEventListener("keydown",L),window.addEventListener("keyup",Y),e.addEventListener("contextmenu",m=>{T&&m.preventDefault()}),e.style.cursor="grab";const Q=()=>{h=e.clientWidth||window.innerWidth||1e3,v=e.clientHeight||window.innerHeight||800,c.setAttribute("viewBox",`0 0 ${h} ${v}`),c.setAttribute("width",String(h)),c.setAttribute("height",String(v));const m=h/2,j=v/2,W=Math.min(h,v),$=W*.18,J=W*.16;d.forEach((B,R)=>{const I=$+R*J,H=n.filter(X=>X.tier===B),V=H.length||1,q=Math.PI*2/V,ee=-Math.PI/2;H.forEach((X,Ne)=>{const ue=ee+q*Ne,fe=m+I*Math.cos(ue),he=j+I*Math.sin(ue),te=c.querySelector(`circle[data-id="${X.id}"]`);te&&(te.setAttribute("cx",String(fe)),te.setAttribute("cy",String(he)));const ne=c.querySelector(`text[data-id="${X.id}"]`);ne&&(ne.setAttribute("x",String(fe)),ne.setAttribute("y",String(he+3)))})})},F=new ResizeObserver(Q);return F.observe(e),window.addEventListener("resize",Q),{svg:c,setZoom:m=>{g=Math.max(p,Math.min(r,m)),c.style.transform=`scale(${g/100})`,c.style.transformOrigin="center center"},getZoom:()=>g,destroy:()=>{e.removeEventListener("wheel",y),e.removeEventListener("mousedown",_),window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",C),window.removeEventListener("keydown",L),window.removeEventListener("keyup",Y),window.removeEventListener("resize",Q),F.disconnect()}}}function $e(e,o,i){const a=document.createElement("div");a.className="list-tier";const t=document.createElement("button");t.className="list-tier__header",t.setAttribute("aria-expanded","true");const n=document.createElement("span");n.className="list-tier__title";const u={1:"üå±",2:"üåø",3:"üå≥"};n.textContent=`${u[e]||"üìã"} Tier ${e}`;const h=document.createElement("span");h.className="list-tier__count";const v=o.filter(s=>U(s.id)).length;h.textContent=`${v}/${o.length}`;const l=document.createElement("span");l.className="list-tier__icon",l.textContent="‚ñº",t.appendChild(n),t.appendChild(h),t.appendChild(l);const c=document.createElement("div");c.className="list-tier__content",c.style.display="block";const g=[...o].sort((s,d)=>{const E=U(s.id),x=U(d.id);return E===x?0:E?1:-1}),p=g.filter(s=>!U(s.id)),r=g.filter(s=>U(s.id));if(p.forEach(s=>{const d=Ee(s,i);c.appendChild(d)}),p.length>0&&r.length>0){const s=document.createElement("div");s.className="list-tier__separator",s.textContent="Completed",c.appendChild(s)}return r.forEach(s=>{const d=Ee(s,i);c.appendChild(d)}),t.addEventListener("click",()=>{const s=c.style.display!=="none";c.style.display=s?"none":"block",t.setAttribute("aria-expanded",!s),l.textContent=s?"‚ñ∂":"‚ñº",a.classList.toggle("list-tier--collapsed",s)}),a.appendChild(t),a.appendChild(c),a}function Ee(e,o){const i=U(e.id),t=Z(e.id).status||"unsubmitted",n=document.createElement("div"),u=t==="submitted"?" list-node--pending-evidence":t==="approved"?" list-node--approved-evidence":"";n.className=`list-node ${i?"list-node--completed":""}${u}`,n.setAttribute("data-quest-id",e.id);const h=document.createElement("button");h.className="list-node__main";const v=document.createElement("div");v.className="list-node__left";const l=document.createElement("span");l.className="list-node__emoji",l.textContent=e.emoji||"üçÉ";const c=document.createElement("div");c.className="list-node__info";const g=document.createElement("span");g.className="list-node__title",g.textContent=e.title;const p=document.createElement("span");p.className="list-node__category",p.textContent=e.category,c.appendChild(g),c.appendChild(p),v.appendChild(l),v.appendChild(c);const r=document.createElement("div");if(r.className="list-node__right",e.points){const k=document.createElement("div");k.className="list-node__points",Object.entries(e.points).forEach(([M,T])=>{if(T>0){const f=me()[M]||M,y=document.createElement("span");y.className="list-node__point",y.textContent=`+${T} ${f.substring(0,3)}`,k.appendChild(y)}}),r.appendChild(k)}const s=document.createElement("input");s.type="checkbox",s.className="list-node__checkbox",s.checked=i,s.addEventListener("change",k=>{k.stopPropagation();const M=n.closest(".list-view-container"),T=M?M.scrollTop:0;be(e.id,k.target.checked,e.points||{}),n.classList.toggle("list-node--completed",k.target.checked),M&&T>0&&requestAnimationFrame(()=>{M.scrollTop=T})});const d=document.createElement("span");d.className="list-node__expand",d.textContent="‚ñ∂",r.appendChild(s),r.appendChild(d),h.appendChild(v),h.appendChild(r);const E=document.createElement("div");E.className="list-node__details",E.style.display="none";const x=document.createElement("p");x.className="list-node__description",x.textContent=e.description;const A=document.createElement("div");A.className="list-node__actions";const O=document.createElement("button");return O.className="list-node__action-btn",O.textContent="View Details",O.addEventListener("click",k=>{k.stopPropagation(),o&&o(e)}),A.appendChild(O),E.appendChild(x),E.appendChild(A),h.addEventListener("click",()=>{const k=E.style.display!=="none";E.style.display=k?"none":"block",d.textContent=k?"‚ñ∂":"‚ñº",n.classList.toggle("list-node--expanded",!k)}),n.appendChild(h),n.appendChild(E),n}function je(e,o=[]){const i=document.createElement("div");i.className="list-view";let a="all",t=0;const n=i.closest(".list-view-container")||i.parentElement;function u(){n&&(t=n.scrollTop)}function h(){n&&t>0&&requestAnimationFrame(()=>{n.scrollTop=t})}function v(){u(),i.innerHTML="";const l=document.createElement("div");l.className="list-view__filters",[{id:"all",label:"All"},{id:"active",label:"Active"},{id:"completed",label:"Completed"},{id:"in_review",label:"In Review"},{id:"accepted",label:"Accepted"}].forEach(r=>{const s=document.createElement("button");s.className=`list-view__filter ${a===r.id?"list-view__filter--active":""}`,s.textContent=r.label,s.addEventListener("click",()=>{a=r.id,v()}),l.appendChild(s)}),i.appendChild(l);const g=new Map;o.forEach(r=>{g.has(r.tier)||g.set(r.tier,[]),g.get(r.tier).push(r)}),Array.from(g.keys()).sort((r,s)=>r-s).forEach(r=>{const s=g.get(r);let d=s;if(a==="active"?d=s.filter(E=>!U(E.id)):a==="completed"?d=s.filter(E=>U(E.id)):a==="in_review"?d=s.filter(E=>Z(E.id).status==="submitted"):a==="accepted"&&(d=s.filter(E=>Z(E.id).status==="approved")),d.length>0||a==="all"){const x=$e(r,a==="all"?s:d,e);i.appendChild(x)}}),h()}return v(),we(()=>{v()}),i}function ae(e,o){const i=document.createElement("div");i.className="progress-stepper";const a=o?Math.round(e/o*100):0,t=[0,25,50,75,100],n=document.createElement("div");n.className="progress-stepper__bar",t.forEach((h,v)=>{const l=document.createElement("div");l.className="progress-stepper__step";const c=a>=h,g=a>=h&&(v===t.length-1||a<t[v+1]);c&&l.classList.add("progress-stepper__step--reached"),g&&l.classList.add("progress-stepper__step--current");const p=document.createElement("div");p.className="progress-stepper__circle",c?p.textContent="‚úì":p.textContent=h;const r=document.createElement("div");if(r.className="progress-stepper__label",r.textContent=`${h}%`,l.appendChild(p),l.appendChild(r),v<t.length-1){const s=document.createElement("div");s.className="progress-stepper__connector",c&&a>=t[v+1]&&s.classList.add("progress-stepper__connector--filled"),l.appendChild(s)}n.appendChild(l)});const u=document.createElement("div");return u.className="progress-stepper__info",u.textContent=`${e} of ${o} nodes completed`,i.appendChild(n),i.appendChild(u),i}function ie(e,o){const i=document.createElement("div");i.className="settings-menu";const a=document.createElement("button");a.className="settings-menu__button",a.setAttribute("aria-label","Settings menu"),a.setAttribute("aria-expanded","false"),a.textContent="‚ò∞";const t=document.createElement("div");t.className="settings-menu__dropdown",t.style.display="none";const n=document.createElement("button");n.className="settings-menu__item",n.textContent="Export JSON",n.addEventListener("click",()=>{e&&e(),g()});const u=document.createElement("button");u.className="settings-menu__item",u.textContent="Load config JSON",u.addEventListener("click",()=>{const p=document.createElement("input");p.type="file",p.accept="application/json",p.style.display="none",p.addEventListener("change",async()=>{const r=p.files&&p.files[0];if(r)try{const s=await r.text(),d=JSON.parse(s);if(!d.quests||!Array.isArray(d.quests)){window.alert('Invalid config: missing "quests" array.');return}window.localStorage.setItem("skill_tree_custom_config",s),window.location.reload()}catch(s){console.error("Failed to load config JSON",s),window.alert("Failed to load config JSON. Please check the file format.")}}),document.body.appendChild(p),p.click(),p.addEventListener("blur",()=>{p.remove()}),g()});const h=document.createElement("button");h.className="settings-menu__item",h.textContent="Open demo site",h.addEventListener("click",()=>{window.open("https://gm3.github.io/gg/","_blank"),g()});const v=document.createElement("button");v.className="settings-menu__item",v.textContent="Open GitHub repo",v.addEventListener("click",()=>{window.open("https://github.com/gm3/gg","_blank"),g()});const l=document.createElement("button");l.className="settings-menu__item settings-menu__item--danger",l.textContent="Clear All",l.addEventListener("click",()=>{window.confirm("Reset all completed quests and reflections?")&&o&&o(),g()}),t.appendChild(n),t.appendChild(u),t.appendChild(h),t.appendChild(v),t.appendChild(l);function c(){t.style.display="block",a.setAttribute("aria-expanded","true"),a.classList.add("settings-menu__button--active")}function g(){t.style.display="none",a.setAttribute("aria-expanded","false"),a.classList.remove("settings-menu__button--active")}return a.addEventListener("click",p=>{p.stopPropagation(),t.style.display==="block"?g():c()}),document.addEventListener("click",p=>{i.contains(p.target)||g()}),i.appendChild(a),i.appendChild(t),i}function Ce(){return window.innerWidth<768||window.innerHeight>window.innerWidth}function Ie(e,{quests:o,config:i}){ke();let a=null,t=null,n=Ce()?"list":"tree";function u(){const r={progress:de(),quests:o,config:i,exportedAt:new Date().toISOString()},s=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),d=URL.createObjectURL(s),E=document.createElement("a");E.href=d,E.download=`${i?.appName?.toLowerCase().replace(/\s+/g,"-")||"skill-tree"}-progress.json`,E.click(),URL.revokeObjectURL(d)}function h(r){a&&v(),a=Oe(r,v,()=>{g()}),e.appendChild(a)}function v(){a&&(a.dispatchEvent(new Event("remove")),a.remove(),a=null)}let l=e.querySelector(".fullscreen-container"),c=!0;function g(){const{completedQuests:r}=de(),s=r.length,d=o.length;if(c||!l)e.innerHTML="",l=document.createElement("div"),l.className="fullscreen-container",e.appendChild(l),c=!1;else if(n==="list"){const f=l.querySelector(".overlay-stats");if(f){f.innerHTML="";const _=document.createElement("button");_.className="view-toggle",_.setAttribute("aria-label","Toggle view");const S=document.createElement("span");S.className="view-toggle__icon",S.textContent=n==="tree"?"‚ò∞":"üå≥";const C=document.createElement("span");C.className="view-toggle__label",C.textContent=n==="tree"?"List":"Tree",_.appendChild(S),_.appendChild(C),_.addEventListener("click",()=>{n=n==="tree"?"list":"tree",c=!0,g()});const N=ie(u,()=>{se()}),b=document.createElement("div");b.className="character-stats__toggle",b.appendChild(_),b.appendChild(N);const L=oe(s,d,b,i?.appName||"Skill Tree");f.appendChild(L)}const y=l.querySelector(".list-view-container");if(y){const _=y.querySelector(".progress-stepper");if(_){const S=ae(s,d);_.replaceWith(S)}}return}else if(n==="tree"){const f=l.querySelector(".overlay-stats");if(f){f.innerHTML="";const _=document.createElement("button");_.className="view-toggle",_.setAttribute("aria-label","Toggle view");const S=document.createElement("span");S.className="view-toggle__icon",S.textContent=n==="tree"?"‚ò∞":"üå≥";const C=document.createElement("span");C.className="view-toggle__label",C.textContent=n==="tree"?"List":"Tree",_.appendChild(S),_.appendChild(C),_.addEventListener("click",()=>{n=n==="tree"?"list":"tree",c=!0,g()});const N=ie(u,()=>{se()}),b=document.createElement("div");b.className="character-stats__toggle",b.appendChild(_),b.appendChild(N);const L=oe(s,d,b,i?.appName||"Skill Tree");f.appendChild(L)}const y=l.querySelector(".tree-visual-fullscreen");if(y){const _=y.querySelector(".tree-visual__canvas-fullscreen");_&&t&&(t.destroy&&t.destroy(),t=_e(_,r,S=>h(S),(S,C)=>{const N=y.querySelector(".tree-tooltip");if(N&&S&&C){N.style.display="block",N.textContent=`${S.emoji||"üçÉ"} ${S.title}`;const b=N.offsetWidth||150;let L=C.x;L<b/2?L=b/2:L>y.clientWidth-b/2&&(L=y.clientWidth-b/2),N.style.left=`${L}px`,N.style.top=`${Math.max(C.y-8,8)}px`}},()=>{const S=y.querySelector(".tree-tooltip");S&&(S.style.display="none")},o))}return}let E=l.querySelector(".overlay-stats");E?E.innerHTML="":(E=document.createElement("div"),E.className="overlay-stats",l.appendChild(E));const x=document.createElement("button");x.className="view-toggle",x.setAttribute("aria-label","Toggle view");const A=document.createElement("span");A.className="view-toggle__icon",A.textContent=n==="tree"?"‚ò∞":"üå≥";const O=document.createElement("span");O.className="view-toggle__label",O.textContent=n==="tree"?"List":"Tree",x.appendChild(A),x.appendChild(O),x.addEventListener("click",()=>{n=n==="tree"?"list":"tree",c=!0,g()});const k=ie(u,()=>{se()}),M=document.createElement("div");M.className="character-stats__toggle",M.appendChild(x),M.appendChild(k);const T=oe(s,d,M,i?.appName||"Skill Tree");if(E.appendChild(T),n==="tree"){let S=function(C,N){if(_)if(C&&N){_.style.display="block",_.textContent=`${C.emoji||"üçÉ"} ${C.title}`;const b=_.offsetWidth||150;let L=N.x;L<b/2?L=b/2:L>f.clientWidth-b/2&&(L=f.clientWidth-b/2),_.style.left=`${L}px`,_.style.top=`${Math.max(N.y-8,8)}px`}else _.style.display="none"};var P=S;let f=l.querySelector(".tree-visual-fullscreen");if(!f){f=document.createElement("section"),f.className="tree-visual-fullscreen";const C=document.createElement("div");C.className="tree-visual__canvas-fullscreen",f.appendChild(C),l.appendChild(f);const N=document.createElement("div");N.className="tree-tooltip",N.style.display="none",f.appendChild(N)}let y=f.querySelector(".tree-visual__canvas-fullscreen");y||(y=document.createElement("div"),y.className="tree-visual__canvas-fullscreen",f.appendChild(y));const _=f.querySelector(".tree-tooltip");t&&t.destroy&&(t.destroy(),t=null),y.innerHTML="",t=_e(y,r,C=>h(C),(C,N)=>S(C,N),()=>S(null),o)}else{let f=l.querySelector(".list-view-container");if(f){const y=f.querySelector(".progress-stepper");if(y){const _=ae(s,d);y.replaceWith(_)}}else{f=document.createElement("section"),f.className="list-view-container",l.appendChild(f);const y=ae(s,d);f.appendChild(y);const _=je(S=>h(S),o);f.appendChild(_)}}if(n==="tree"){const f=document.createElement("div");f.className="overlay-bottom";const y=document.createElement("div");y.className="overlay-instructions",y.textContent="Scroll to zoom ‚Ä¢ Drag to pan ‚Ä¢ Click nodes for details",f.appendChild(y),l.appendChild(f)}}const p=()=>{Ce()&&n==="tree"&&(n="list",g())};return window.addEventListener("resize",p),g(),we(g),()=>{window.removeEventListener("resize",p),t&&t.destroy&&t.destroy(),a&&v()}}let le=null;async function Re(){if(le)return le;try{let e=null;try{const o=window.localStorage.getItem("skill_tree_custom_config");o&&(e=JSON.parse(o))}catch(o){console.warn("Failed to parse custom config from localStorage, ignoring override",o),e=null}if(!e){const o=await fetch("config.json");if(!o.ok)throw new Error("Failed to load config.json");e=await o.json()}return(!e.quests||!Array.isArray(e.quests))&&(console.warn("config.json missing quests array, using empty array"),e.quests=[]),(!e.statTypes||typeof e.statTypes!="object")&&(console.warn("config.json missing statTypes, using defaults"),e.statTypes={goodness:"Goodness",thoughtfulness:"Thoughtfulness",kindness:"Kindness",empathy:"Empathy"}),(!e.defaultStats||typeof e.defaultStats!="object")&&(console.warn("config.json missing defaultStats, initializing from statTypes"),e.defaultStats={},Object.keys(e.statTypes).forEach(o=>{e.defaultStats[o]=0})),le=e,e}catch(e){return console.error("Failed to load config.json:",e),{appName:"Skill Tree",statTypes:{goodness:"Goodness",thoughtfulness:"Thoughtfulness",kindness:"Kindness",empathy:"Empathy"},defaultStats:{goodness:0,thoughtfulness:0,kindness:0,empathy:0},storageKey:"skill_tree_progress",quests:[]}}}async function Pe(){const e=document.querySelector("#app");if(!e){console.error("App root element not found");return}try{const o=await Re();Le(o);const i=o.quests||[];if(i.length===0){console.warn("No quests found in config.json"),e.innerHTML='<div style="padding: 2rem; text-align: center; color: #e5e7eb;"><h2>No quests found</h2><p>Please ensure config.json contains a "quests" array with at least one quest.</p></div>';return}Ie(e,{config:o,quests:i})}catch(o){console.error("Failed to initialize app:",o),e.innerHTML='<div style="padding: 2rem; text-align: center; color: #e5e7eb;"><h2>Error loading app</h2><p>Please check the console for details.</p></div>'}}Pe();
